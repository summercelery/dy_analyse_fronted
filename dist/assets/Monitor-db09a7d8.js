/* empty css                  *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                        *//* empty css                  */import{a as Le}from"./author-f82feaee.js";/* empty css               *//* empty css                 */import{X as dt,u as ct,a as mt,r as x,n as X,p as ft,Y as vt,o as v,c as y,d as s,e as l,w as a,t as d,s as _,h as f,N as se,O as ye,Z as $,_ as ce,$ as z,x as m,y as oe,z as pt,A as _t,B as gt,C as yt,k as ht,i as wt,U as It,a0 as kt,G as xt,J as Ct,K as Et,L as Ae,a1 as Vt,a2 as bt,a3 as Mt,a4 as Dt,M as St,a5 as Tt,v as Lt,f as At,a6 as Nt,a7 as Pt,a8 as $t,a9 as zt,aa as Ut,ab as Rt,ac as Bt,ad as Ft,ae as Ot,af as Gt,P as Jt,Q as jt,R as qt,T as Kt,ag as Qt,ah as Wt,ai as Xt,aj as Yt,ak as Zt,al as Ht,j as es,am as ts,an as ss,l as os,ao as as,F as ls}from"./index-05b32c45.js";import{m as G}from"./monitor-f783f035.js";import{m as he}from"./music-5602df81.js";import{v as me}from"./video-a55d9aa9.js";import{p as fe}from"./tagUtils-dd34c03c.js";import{_ as ns}from"./_plugin-vue_export-helper-c27b6911.js";const is={class:"monitor-layout"},rs={class:"header"},us={class:"header-right"},ds={class:"user-info"},cs={class:"username"},ms={class:"main-container"},fs={class:"sidebar"},vs={class:"content"},ps={class:"page-header"},_s={key:0,class:"page-title-section"},gs={class:"page-title"},ys={class:"music-meta"},hs={class:"page-meta"},ws={key:0},Is={class:"stats-row"},ks={class:"stat-icon"},xs={class:"stat-info"},Cs={class:"stat-value"},Es={class:"stat-icon"},Vs={class:"stat-info"},bs={class:"stat-value"},Ms={class:"stat-icon"},Ds={class:"stat-info"},Ss={class:"stat-value"},Ts={class:"stat-icon"},Ls={class:"stat-info"},As={class:"stat-value"},Ns={class:"toolbar"},Ps={class:"toolbar-left"},$s={class:"toolbar-right"},zs={class:"card-header"},Us={class:"header-actions"},Rs={class:"video-id"},Bs={key:1};const Fs={class:"video-desc"},Os={class:"desc-text"},Gs={key:1,class:"na-text"},Js={class:"author-name"},js={key:0,class:"music-info"},qs={class:"music-title"},Ks={class:"music-author"},Qs={key:1,class:"na-text"},Ws={key:0,class:"hashtag-list"},Xs={key:1,class:"na-text"},Ys={key:0,class:"stats-preview"},Zs={class:"stats-item"},Hs={class:"stats-item"},eo={key:1,class:"na-text"},to={class:"publish-time"},so={class:"table-actions"},oo={style:{"line-height":"1.6"}},ao={style:{margin:"8px 0"}},lo={class:"music-info-display"},no={class:"music-title"},io={key:0,class:"music-album"},ro={key:1,class:"music-tags"},uo={class:"music-info-display"},co={class:"task-progress-container"},mo={class:"task-info"},fo={class:"progress-section"},vo={key:0,class:"progress-stats"},po={class:"task-stats-row"},_o={class:"task-stats-row"},go={style:{color:"#67c23a"}},yo={style:{color:"#909399"}},ho={style:{color:"#f56c6c"}},wo={key:0,class:"processing-tip"},Io={key:1,class:"completed-message"},ko={key:2,class:"failed-message"},xo={__name:"Monitor",setup(Co){const we=dt(),ae=ct(),j=mt(),le=x(!1),ve=x(!1),S=x([]),ne=x(""),U=x([]),T=x(null),V=x(null),q=x(!1),K=x(!1),ie=x(!1),pe=x(!1),J=x("single"),C=x({videoUrl:"",file:null}),h=x({id:null,fileName:"",status:"PENDING",progress:0,totalCount:0,processedCount:0,successCount:0,skipCount:0,errorCount:0}),N=x(null),Y=x(!1),_e=x(!1),Z=x({email:""}),Ie=X(()=>{let t=S.value;switch(Q.value){case"all":t=S.value;break;case"monitoring":t=S.value.filter(i=>{var n;return((n=i.monitorVideo)==null?void 0:n.status)===1});break;case"error":t=S.value.filter(i=>{var r;const n=(r=i.monitorVideo)==null?void 0:r.status;return n!==0&&n!==1});break;case"auto":t=S.value.filter(i=>{var n;return((n=i.monitorVideo)==null?void 0:n.type)===0});break;default:t=S.value}if(T.value&&(t=t.filter(i=>{var r,c;return(((r=i.userMonitor)==null?void 0:r.musicId)||((c=i.monitorVideo)==null?void 0:c.musicId))===T.value})),ne.value){const i=ne.value.toLowerCase();t=t.filter(n=>{var b,E,p,A,D;const r=((E=(b=n.monitorVideo)==null?void 0:b.awemeId)==null?void 0:E.toString())||"",c=((p=n.monitorVideo)==null?void 0:p.videoUrl)||"",u=((A=n.authorInfo)==null?void 0:A.nickname)||"",w=((D=n.videoInfo)==null?void 0:D.authorId)||"";return r.toLowerCase().includes(i)||c.toLowerCase().includes(i)||u.toLowerCase().includes(i)||w.toLowerCase().includes(i)})}return t.slice().sort((i,n)=>{var u,w;const r=((u=i==null?void 0:i.latestStats)==null?void 0:u.diggCount)||0;return(((w=n==null?void 0:n.latestStats)==null?void 0:w.diggCount)||0)-r})}),Ne=X(()=>S.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.status)===1}));X(()=>S.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.status)===0}));const Pe=X(()=>S.value.filter(t=>{var i;const e=(i=t.monitorVideo)==null?void 0:i.status;return e!==0&&e!==1})),$e=X(()=>S.value),ze=X(()=>S.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.type)===0})),Q=x("all"),re=t=>{Q.value=t;const e={all:"已显示所有监控视频",monitoring:"已过滤显示监控中的视频",error:"已过滤显示异常监控的视频",auto:"已过滤显示自动添加的视频"};m.success(e[t]||"过滤完成")},H=t=>{var i;let e=null;if((i=t.videoInfo)!=null&&i.topics?e=t.videoInfo.topics:t.topics&&(e=t.topics),Array.isArray(e))return e;if(typeof e=="string")try{const n=JSON.parse(e);if(Array.isArray(n))return n}catch{}return[]},ge=t=>{var n;let e=null;return(n=t.videoInfo)!=null&&n.desc?e=t.videoInfo.desc:t.desc&&(e=t.desc),e?e.replace(/#[^\s#]*/g,"").trim()||e:""},ke=t=>t?t>=1e4?(t/1e4).toFixed(1)+"w":t.toString():"0",Ue=t=>t?new Date(t*1e3).toLocaleString("zh-CN"):"N/A",Re=t=>t?t>=1e4?(t/1e4).toFixed(1)+"w":t.toString():"0",Be=t=>{switch(t){case 1:return"success";case 0:return"info";case 2:return"warning";case 3:return"danger";default:return"info"}},Fe=t=>{switch(t){case 1:return"启用";case 0:return"停用";case 2:return"无权限";case 3:return"失败";default:return"未知"}},R=async()=>{le.value=!0;try{const t=await G.getMonitorList();if(console.log("Monitor页面: 监控列表API响应:",t),t.code===200){let e=t.data||[];console.log("Monitor页面: 处理后的监控数据:",e),T.value&&(e=e.filter(i=>{var r,c;return(((r=i.userMonitor)==null?void 0:r.musicId)||((c=i.monitorVideo)==null?void 0:c.musicId))==T.value}),console.log("Monitor页面: 过滤后的音乐监控数据:",e)),e.length>0&&console.log("Monitor页面: 第一条数据结构:",JSON.stringify(e[0],null,2));try{const i=await me.getMonitorVideoDetails();if(console.log("Monitor页面: 详细信息API响应:",i),i.code===200){const n=i.data||[];console.log("Monitor页面: 详细信息数据:",n);const r=await Promise.all(e.map(async c=>{var p,A,D,M,B,g;const u=n.find(I=>{var F,ue,O,te;return((F=I.monitor)==null?void 0:F.awemeId)===((ue=c.monitorVideo)==null?void 0:ue.awemeId)||((O=I.monitorVideo)==null?void 0:O.awemeId)===((te=c.monitorVideo)==null?void 0:te.awemeId)});let w=(u==null?void 0:u.music)||(u==null?void 0:u.musicInfo),b=u==null?void 0:u.video,E=null;if(!w&&((p=c.userMonitor)!=null&&p.musicId||(A=c.monitorVideo)!=null&&A.musicId))try{const I=((D=c.userMonitor)==null?void 0:D.musicId)||((M=c.monitorVideo)==null?void 0:M.musicId),F=await he.getMusicById(I);F.code===200&&(w=F.data)}catch(I){console.warn("获取音乐信息失败:",I)}if(!b&&((B=c.monitorVideo)!=null&&B.awemeId))try{const I=await me.getVideoInfo(c.monitorVideo.awemeId);I.code===200&&(b=I.data)}catch(I){console.warn("获取视频信息失败:",I)}if(b!=null&&b.authorId)try{const I=await Le.getAuthorInfo(b.authorId);I.code===200&&(E=I.data)}catch(I){console.warn("获取播主信息失败:",I)}return{...c,musicInfo:w,videoInfo:b,authorInfo:E,latestStats:(u==null?void 0:u.latestStats)||((g=u==null?void 0:u.video)==null?void 0:g.latestStats),video:u==null?void 0:u.video}}));console.log("Monitor页面: 合并后的数据:",r),S.value=r}else{const n=await Promise.all(e.map(async r=>{var E,p,A,D,M,B;let c=null,u=null,w=null,b=null;if((E=r.userMonitor)!=null&&E.musicId||(p=r.monitorVideo)!=null&&p.musicId)try{const g=((A=r.userMonitor)==null?void 0:A.musicId)||((D=r.monitorVideo)==null?void 0:D.musicId),I=await he.getMusicById(g);I.code===200&&(c=I.data)}catch(g){console.warn("获取音乐信息失败:",g)}if((M=r.monitorVideo)!=null&&M.awemeId)try{const g=await me.getVideoInfo(r.monitorVideo.awemeId);g.code===200&&(u=g.data)}catch(g){console.warn("获取视频信息失败:",g)}if(u!=null&&u.authorId)try{const g=await Le.getAuthorInfo(u.authorId);g.code===200&&(w=g.data)}catch(g){console.warn("获取播主信息失败:",g)}if((B=r.monitorVideo)!=null&&B.awemeId)try{const g=await me.getLatestVideoStats(r.monitorVideo.awemeId);g.code===200&&(b=g.data)}catch(g){console.warn("获取统计数据失败:",g)}return{...r,musicInfo:c,videoInfo:u,authorInfo:w,latestStats:b}}));S.value=n}}catch(i){console.warn("Monitor页面: 获取详细信息失败，使用基础数据:",i),S.value=e}}else m.error(t.message||"加载监控列表失败")}catch(t){console.error("Monitor页面: 加载监控列表失败:",t),m.error("加载监控列表失败")}finally{le.value=!1}},Oe=async()=>{var t,e,i,n;if(!C.value.videoUrl.trim()){m.warning("请输入视频链接或ID");return}if(!T.value){m.warning("请先选择要监控的音乐");return}ve.value=!0;try{const r=await G.addMonitor({videoUrl:C.value.videoUrl.trim(),musicId:T.value});r.code===200?(m.success("添加监控成功"),q.value=!1,C.value={videoUrl:"",file:null},await R()):(t=r.message)!=null&&t.includes("音乐ID不能为空，音乐为必选项")?m.error("音乐为必选项，请先选择音乐"):(e=r.message)!=null&&e.includes("指定的音乐不存在，请选择有效的音乐")?m.error("所选音乐不存在，请重新选择"):(i=r.message)!=null&&i.includes("视频链接不能为空")?m.error("请输入视频链接"):(n=r.message)!=null&&n.includes("添加失败，可能是链接格式错误或已存在")?m.error("视频链接格式错误或该视频已在监控中"):m.error(r.message||"添加监控失败")}catch{m.error("添加监控失败")}finally{ve.value=!1}},xe=()=>{if(C.value={videoUrl:"",file:null},ee.value)try{ee.value.clearFiles()}catch(t){console.warn("清理上传组件失败:",t)}},Ge=()=>{const t=document.createElement("a");t.href="/监控视频模板.xlsx",t.download="监控视频模板.xlsx",document.body.appendChild(t),t.click(),document.body.removeChild(t)},ee=x(),Je=t=>{var n,r;if(console.log("文件选择:",t),!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/csv"].includes(t.raw.type)&&!t.name.endsWith(".csv")){m.error("请选择 .xlsx、.xls 或 .csv 格式的文件");try{(n=ee.value)==null||n.clearFiles()}catch(c){console.warn("清理上传文件失败:",c)}C.value.file=null;return}const i=10*1024*1024;if(t.raw.size>i){m.error("文件大小不能超过 10MB");try{(r=ee.value)==null||r.clearFiles()}catch(c){console.warn("清理上传文件失败:",c)}C.value.file=null;return}C.value.file=t.raw},je=()=>{console.log("文件移除"),C.value.file=null},qe=async()=>{var t,e,i,n,r;if(!T.value){m.warning("请先选择要监控的音乐");return}if(!C.value.file){m.warning("请选择要上传的Excel文件");return}if(!C.value.file.name){m.error("文件信息不完整，请重新选择文件"),C.value.file=null;return}pe.value=!0;try{const c=new FormData;c.append("file",C.value.file),c.append("musicId",T.value.toString()),console.log("开始上传Excel文件:",{fileName:C.value.file.name,fileSize:C.value.file.size,musicId:T.value});const u=await G.uploadExcelAsync(c);if(u.code===200){const{taskId:w,message:b}=u.data;m.success("文件上传成功，正在后台处理中...");const E=((t=C.value.file)==null?void 0:t.name)||"未知文件";q.value=!1,xe(),Ke(w,E)}else{let w=u.message||"Excel上传失败";(e=u.message)!=null&&e.includes("请选择要上传的Excel文件")?w="请选择要上传的Excel文件":(i=u.message)!=null&&i.includes("文件格式不正确，请上传Excel文件(.xlsx或.xls)")?w="文件格式不正确，请上传Excel文件(.xlsx或.xls)":(n=u.message)!=null&&n.includes("音乐ID不能为空，音乐为必选项")?w="音乐为必选项，请先选择音乐":(r=u.message)!=null&&r.includes("指定的音乐不存在，请选择有效的音乐")&&(w="所选音乐不存在，请重新选择音乐"),m.error(w)}}catch(c){console.error("Excel上传失败:",c),m.error("Excel上传失败，请检查网络连接后重试")}finally{pe.value=!1}},Ke=(t,e)=>{h.value={id:t,fileName:e,status:"PENDING",progress:0,totalCount:0,processedCount:0,successCount:0,skipCount:0,errorCount:0},ie.value=!0,Qe()},Qe=()=>{N.value&&clearInterval(N.value),N.value=setInterval(async()=>{try{const t=await G.getTaskProgress(h.value.id);if(t.code===200){const e=t.data;h.value={...h.value,...e},(e.status==="COMPLETED"||e.status==="FAILED")&&(clearInterval(N.value),N.value=null,e.status==="COMPLETED"&&await R())}}catch(t){console.error("查询任务进度失败:",t)}},2e3)},Ce=()=>{N.value&&(clearInterval(N.value),N.value=null),ie.value=!1},We=t=>{switch(t){case"PENDING":return"等待处理";case"PROCESSING":return"处理中";case"COMPLETED":return"已完成";case"FAILED":return"处理失败";default:return"未知状态"}},Xe=t=>{switch(t){case"PENDING":return"info";case"PROCESSING":return"warning";case"COMPLETED":return"success";case"FAILED":return"danger";default:return"info"}},Ye=t=>{t?ae.push(`/stats/${t}`):m.warning("视频ID无效")},Ze=async t=>{var r;const i=((r=t.monitorVideo)==null?void 0:r.status)===1?0:1,n=i===1?"启用":"停用";try{await oe.confirm(`确认${n}该监控视频？`,"提示",{type:"warning"});const c=await G.updateStatus(t.monitorVideo.id,{status:i});c.code===200?(await R(),m.success(`${n}成功`)):m.error(c.message||`${n}失败`)}catch(c){c!=="cancel"&&m.error(`${n}失败`)}},He=async t=>{try{await oe.confirm("确认删除该监控视频？删除后无法恢复","警告",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"});const e=await G.deleteMonitor(t.monitorVideo.id);e.code===200?(await R(),m.success("删除成功")):m.error(e.message||"删除失败")}catch(e){e!=="cancel"&&m.error("删除失败")}},et=t=>{U.value=t},Ee=async t=>{const e=t===1?"启用":"停用";try{await oe.confirm(`确认批量${e}选中的 ${U.value.length} 个监控项？`,"提示",{type:"warning"});const i=U.value.map(n=>G.updateStatus(n.monitorVideo.id,{status:t}));await Promise.all(i),await R(),K.value=!1,U.value=[],m.success(`批量${e}成功`)}catch(i){i!=="cancel"&&m.error(`批量${e}失败`)}},tt=async()=>{try{await oe.confirm(`确认批量删除选中的 ${U.value.length} 个监控项？删除后无法恢复`,"警告",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"});const t=U.value.map(e=>G.deleteMonitor(e.monitorVideo.id));await Promise.all(t),await R(),K.value=!1,U.value=[],m.success("批量删除成功")}catch(t){t!=="cancel"&&m.error("批量删除失败")}},st=async t=>{var e;if(t==="updateEmail"){Z.value.email=((e=j.user)==null?void 0:e.email)||"",Y.value=!0;return}if(t==="logout")try{await oe.confirm("确认退出登录？","提示",{type:"warning"}),await j.logout(),ae.push("/login")}catch{}},ot=t=>/^[\w.!#$%&'*+/=?^`{|}~-]+@[\w-]+(\.[\w-]+)+$/.test(t),at=async()=>{const t=(Z.value.email||"").trim();if(!t){m.warning("请输入邮箱地址");return}if(!ot(t)){m.warning("邮箱格式不正确");return}_e.value=!0;try{const e=await Gt.updateEmail({email:t});e.code===200?(j.setUser({...j.user||{},email:t}),m.success("邮箱更新成功"),Y.value=!1):m.error(e.message||"邮箱更新失败")}catch{m.error("邮箱更新失败，请稍后重试")}finally{_e.value=!1}},lt=()=>{ae.push("/music")},nt=t=>{var i,n;const e=((i=t==null?void 0:t.videoInfo)==null?void 0:i.authorId)||((n=t==null?void 0:t.authorInfo)==null?void 0:n.userId);e?ae.push(`/author/${e}`):m.warning("无法获取播主ID")};return ft(()=>{we.query.musicId&&(T.value=parseInt(we.query.musicId),he.getMusicById(T.value).then(t=>{(t==null?void 0:t.code)===200&&(V.value=t.data)}).catch(()=>{})),R()}),vt(()=>{N.value&&(clearInterval(N.value),N.value=null)}),(t,e)=>{var be;const i=pt,n=_t,r=Jt,c=jt,u=gt,w=qt,b=yt,E=Kt,p=ht,A=wt,D=Qt,M=Wt,B=Xt,g=Yt,I=It,F=Zt,ue=Ht,O=es,te=ts,it=ss,Ve=os,de=kt,rt=as,ut=ls;return v(),y("div",is,[s("header",rs,[e[22]||(e[22]=s("div",{class:"header-left"},[s("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),s("div",us,[s("div",ds,[l(i,{size:32,class:"user-avatar"},{default:a(()=>{var o,k;return[f(d((k=(o=_(j).user)==null?void 0:o.username)==null?void 0:k.charAt(0)),1)]}),_:1}),s("span",cs,d((be=_(j).user)==null?void 0:be.username),1),l(u,{onCommand:st,class:"user-dropdown"},{dropdown:a(()=>[l(c,null,{default:a(()=>[l(r,{command:"updateEmail"},{default:a(()=>e[20]||(e[20]=[f("更新邮箱",-1)])),_:1,__:[20]}),l(r,{command:"logout"},{default:a(()=>e[21]||(e[21]=[f("退出登录",-1)])),_:1,__:[21]})]),_:1})]),default:a(()=>[l(n,{class:"dropdown-icon"},{default:a(()=>[l(_(xt))]),_:1})]),_:1})])])]),s("div",ms,[s("nav",fs,[l(b,{"default-active":t.$route.path,router:"",class:"sidebar-menu"},{default:a(()=>[l(w,{index:"/music",class:"menu-item"},{default:a(()=>[l(n,null,{default:a(()=>[l(_(Ct))]),_:1}),e[23]||(e[23]=s("span",null,"音乐管理",-1))]),_:1,__:[23]})]),_:1},8,["default-active"])]),s("main",vs,[s("div",ps,[T.value&&V.value?(v(),y("div",_s,[s("h2",gs,[f(d(V.value.title)+" ",1),s("span",ys," · "+d(V.value.author),1)]),s("p",hs,[s("span",null,"专辑："+d(V.value.album||"-"),1),V.value.tagList&&_(fe)(V.value.tagList).length?(v(),y("span",ws,[e[24]||(e[24]=f(" · 标签： ",-1)),(v(!0),y(se,null,ye(_(fe)(V.value.tagList),o=>(v(),z(E,{key:o,size:"small",class:"music-tag"},{default:a(()=>[f(d(o),1)]),_:2},1024))),128))])):$("",!0)])])):(v(),y(se,{key:1},[e[25]||(e[25]=s("h2",{class:"page-title"},"监控管理",-1)),e[26]||(e[26]=s("p",{class:"page-desc"},"管理您的抖音视频监控任务，实时掌握数据变化",-1))],64))]),s("div",Is,[s("div",{class:ce(["stat-card total",{"is-active":Q.value==="all"}]),onClick:e[0]||(e[0]=o=>re("all"))},[s("div",ks,[l(n,{size:"20"},{default:a(()=>[l(_(Et))]),_:1})]),s("div",xs,[s("div",Cs,d($e.value.length),1),e[27]||(e[27]=s("div",{class:"stat-label"},"监控视频总数",-1))])],2),s("div",{class:ce(["stat-card monitoring",{"is-active":Q.value==="monitoring"}]),onClick:e[1]||(e[1]=o=>re("monitoring"))},[s("div",Es,[l(n,{size:"20"},{default:a(()=>[l(_(Ae))]),_:1})]),s("div",Vs,[s("div",bs,d(Ne.value.length),1),e[28]||(e[28]=s("div",{class:"stat-label"},"监控中",-1))])],2),s("div",{class:ce(["stat-card error",{"is-active":Q.value==="error"}]),onClick:e[2]||(e[2]=o=>re("error"))},[s("div",Ms,[l(n,{size:"20"},{default:a(()=>[l(_(Vt))]),_:1})]),s("div",Ds,[s("div",Ss,d(Pe.value.length),1),e[29]||(e[29]=s("div",{class:"stat-label"},"异常监控",-1))])],2),s("div",{class:ce(["stat-card auto",{"is-active":Q.value==="auto"}]),onClick:e[3]||(e[3]=o=>re("auto"))},[s("div",Ts,[l(n,{size:"20"},{default:a(()=>[l(_(bt))]),_:1})]),s("div",Ls,[s("div",As,d(ze.value.length),1),e[30]||(e[30]=s("div",{class:"stat-label"},"自动添加",-1))])],2)]),e[36]||(e[36]=s("div",{class:"section-divider"},null,-1)),s("div",Ns,[s("div",Ps,[T.value?(v(),z(p,{key:0,onClick:lt,icon:_(Mt)},{default:a(()=>e[31]||(e[31]=[f(" 返回 ",-1)])),_:1,__:[31]},8,["icon"])):$("",!0),l(p,{type:"primary",onClick:e[4]||(e[4]=o=>q.value=!0),icon:_(Dt)},{default:a(()=>e[32]||(e[32]=[f(" 添加监控 ",-1)])),_:1,__:[32]},8,["icon"]),l(p,{onClick:R,loading:le.value,icon:_(St)},{default:a(()=>e[33]||(e[33]=[f(" 刷新 ",-1)])),_:1,__:[33]},8,["loading","icon"])]),s("div",$s,[l(A,{modelValue:ne.value,"onUpdate:modelValue":e[5]||(e[5]=o=>ne.value=o),placeholder:"搜索视频ID、链接或播主名称","prefix-icon":_(Tt),style:{width:"300px"},clearable:""},null,8,["modelValue","prefix-icon"])])]),l(I,{class:"monitor-table-card"},{header:a(()=>[s("div",zs,[e[34]||(e[34]=s("span",{class:"card-title"},"监控列表",-1)),s("div",Us,[l(D,{content:"批量操作",placement:"top"},{default:a(()=>[l(p,{disabled:U.value.length===0,onClick:e[6]||(e[6]=o=>K.value=!0),size:"small"},{default:a(()=>[f(" 批量操作 ("+d(U.value.length)+") ",1)]),_:1},8,["disabled"])]),_:1})])])]),default:a(()=>[Lt((v(),y("div",null,[l(g,{data:Ie.value,style:{width:"100%"},onSelectionChange:et,"empty-text":Ie.value.length===0?"暂无监控数据":"",size:"default","cell-style":{padding:"6px 6px"},"header-cell-style":{padding:"8px 6px",background:"#fafafa"}},{default:a(()=>[l(M,{type:"selection",width:"50"}),l(M,{label:"视频ID",width:"140"},{default:a(({row:o})=>{var k,L,P,W,Me,De;return[s("div",Rs,[(k=o.monitorVideo)!=null&&k.awemeId||(L=o.monitorVideo)!=null&&L.id||o.awemeId?(v(),z(B,{key:0,href:`https://www.douyin.com/video/${((P=o.monitorVideo)==null?void 0:P.awemeId)||((W=o.monitorVideo)==null?void 0:W.id)||o.awemeId}`,target:"_blank",type:"primary",class:"video-id-link"},{default:a(()=>{var Se,Te;return[f(d(((Se=o.monitorVideo)==null?void 0:Se.awemeId)||((Te=o.monitorVideo)==null?void 0:Te.id)||o.awemeId||"N/A"),1)]}),_:2},1032,["href"])):(v(),y("span",Bs,d(((Me=o.monitorVideo)==null?void 0:Me.awemeId)||((De=o.monitorVideo)==null?void 0:De.id)||o.awemeId||"N/A"),1))]),$("",!0)]}),_:1}),l(M,{label:"视频描述",width:"200"},{default:a(({row:o})=>[s("div",Fs,[ge(o)?(v(),z(D,{key:0,content:ge(o),placement:"top","show-after":500},{default:a(()=>[s("span",Os,d(ge(o)),1)]),_:2},1032,["content"])):(v(),y("span",Gs,"无描述"))])]),_:1}),l(M,{label:"播主名称",width:"140"},{default:a(({row:o})=>{var k;return[s("div",Js,[l(B,{type:"primary",class:"author-nickname",onClick:At(L=>nt(o),["stop"])},{default:a(()=>{var L,P;return[f(d(((L=o.authorInfo)==null?void 0:L.nickname)||((P=o.videoInfo)==null?void 0:P.authorId)||"N/A"),1)]}),_:2},1032,["onClick"]),(k=o.authorInfo)!=null&&k.followerCount?(v(),z(E,{key:0,size:"small",type:"info",class:"author-followers-tag"},{default:a(()=>[f(" 粉丝 "+d(Re(o.authorInfo.followerCount)),1)]),_:2},1024)):$("",!0)])]}),_:1}),l(M,{label:"关联音乐",width:"130"},{default:a(({row:o})=>[o.musicInfo?(v(),y("div",js,[s("div",qs,d(o.musicInfo.title),1),s("div",Ks,d(o.musicInfo.author),1)])):(v(),y("span",Qs,"未关联音乐"))]),_:1}),l(M,{label:"话题标签",width:"200"},{default:a(({row:o})=>[H(o).length>0?(v(),y("div",Ws,[(v(!0),y(se,null,ye(H(o).slice(0,5),k=>(v(),z(E,{key:k,size:"small",type:"info",class:"hashtag-tag"},{default:a(()=>[f(d(k),1)]),_:2},1024))),128)),H(o).length>5?(v(),z(D,{key:0,content:H(o).slice(5).join("、"),placement:"top"},{default:a(()=>[l(E,{size:"small",type:"info",class:"hashtag-more"},{default:a(()=>[f(" +"+d(H(o).length-5),1)]),_:2},1024)]),_:2},1032,["content"])):$("",!0)])):(v(),y("span",Xs,"无话题标签"))]),_:1}),l(M,{label:"最新数据",width:"140"},{default:a(({row:o})=>[o.latestStats?(v(),y("div",Ys,[s("div",Zs,[e[35]||(e[35]=s("div",{class:"heart-icon"},[s("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})])],-1)),s("span",null,d(ke(o.latestStats.diggCount||0)),1)]),s("div",Hs,[l(n,{size:"14"},{default:a(()=>[l(_(Nt))]),_:1}),s("span",null,d(ke(o.latestStats.commentCount||0)),1)])])):(v(),y("span",eo,"暂无数据"))]),_:1}),l(M,{label:"发布时间",width:"160",align:"center"},{default:a(({row:o})=>{var k;return[s("div",to,d(Ue((k=o.monitorVideo)==null?void 0:k.videoPublishTime)),1)]}),_:1}),l(M,{label:"状态",width:"100",align:"center"},{default:a(({row:o})=>{var k;return[l(E,{type:Be((k=o.monitorVideo)==null?void 0:k.status),size:"small",class:"status-tag"},{default:a(()=>{var L;return[f(d(Fe((L=o.monitorVideo)==null?void 0:L.status)),1)]}),_:2},1032,["type"])]}),_:1}),l(M,{label:"操作",width:"160",fixed:"right"},{default:a(({row:o})=>{var k;return[s("div",so,[l(D,{content:"查看统计",placement:"top"},{default:a(()=>[l(p,{type:"primary",size:"small",icon:_(Pt),onClick:L=>{var P;return Ye((P=o.monitorVideo)==null?void 0:P.awemeId)},link:""},null,8,["icon","onClick"])]),_:2},1024),l(D,{content:((k=o.monitorVideo)==null?void 0:k.status)===1?"停用监控":"启用监控",placement:"top"},{default:a(()=>{var L,P;return[l(p,{type:((L=o.monitorVideo)==null?void 0:L.status)===1?"warning":"success",size:"small",icon:((P=o.monitorVideo)==null?void 0:P.status)===1?_($t):_(zt),onClick:W=>Ze(o),link:""},{default:a(()=>{var W;return[f(d(((W=o.monitorVideo)==null?void 0:W.status)===1?"停用":"启用"),1)]}),_:2},1032,["type","icon","onClick"])]}),_:2},1032,["content"]),l(D,{content:"删除监控",placement:"top"},{default:a(()=>[l(p,{type:"danger",size:"small",icon:_(Ut),onClick:L=>He(o),link:""},null,8,["icon","onClick"])]),_:2},1024)])]}),_:1})]),_:1},8,["data","empty-text"])])),[[ut,le.value]])]),_:1})])]),l(de,{modelValue:q.value,"onUpdate:modelValue":e[11]||(e[11]=o=>q.value=o),title:"添加监控视频",width:"600px"},{footer:a(()=>[l(p,{onClick:e[9]||(e[9]=o=>q.value=!1)},{default:a(()=>e[46]||(e[46]=[f("取消",-1)])),_:1,__:[46]}),l(p,{type:"primary",onClick:e[10]||(e[10]=o=>J.value==="single"?Oe():qe()),loading:J.value==="single"?ve.value:pe.value,disabled:J.value==="batch"&&!C.value.file},{default:a(()=>[f(d(J.value==="single"?"添加监控":"开始导入"),1)]),_:1},8,["loading","disabled"])]),default:a(()=>[l(ue,{modelValue:J.value,"onUpdate:modelValue":e[7]||(e[7]=o=>J.value=o),style:{"margin-bottom":"20px"},onChange:xe},{default:a(()=>[l(F,{label:"single"},{default:a(()=>e[37]||(e[37]=[f("单个添加",-1)])),_:1,__:[37]}),l(F,{label:"batch"},{default:a(()=>e[38]||(e[38]=[f("批量导入",-1)])),_:1,__:[38]})]),_:1},8,["modelValue"]),l(Ve,{model:C.value,"label-width":"100px"},{default:a(()=>[J.value==="single"?(v(),z(O,{key:0,label:"视频链接"},{default:a(()=>[l(A,{modelValue:C.value.videoUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>C.value.videoUrl=o),placeholder:"请输入抖音视频链接或ID"},null,8,["modelValue"])]),_:1})):(v(),y(se,{key:1},[l(te,{title:"批量导入说明",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:a(()=>[s("div",oo,[e[40]||(e[40]=s("p",null,[s("strong",null,"Excel文件格式要求：")],-1)),e[41]||(e[41]=s("ul",{style:{margin:"8px 0","padding-left":"20px"}},[s("li",null,"支持 .xlsx、.xls 和 .csv 格式"),s("li",null,"第一行为标题行（监控视频地址），会被跳过"),s("li",null,"从第二行开始，第一列为视频链接")],-1)),s("p",ao,[l(p,{type:"primary",size:"small",onClick:Ge,icon:_(Rt)},{default:a(()=>e[39]||(e[39]=[f(" 下载Excel模板 ",-1)])),_:1,__:[39]},8,["icon"])])])]),_:1}),l(O,{label:"Excel文件",required:""},{default:a(()=>[l(it,{ref_key:"uploadRef",ref:ee,"auto-upload":!1,"show-file-list":!0,limit:1,accept:".xlsx,.xls,.csv","on-change":Je,"on-remove":je},{tip:a(()=>e[43]||(e[43]=[s("div",{class:"el-upload__tip",style:{color:"#909399","font-size":"12px","margin-top":"5px"}}," 支持 .xlsx/.xls/.csv 文件，且不超过 10MB ",-1)])),default:a(()=>[l(p,{icon:_(Bt)},{default:a(()=>e[42]||(e[42]=[f("选择Excel文件",-1)])),_:1,__:[42]},8,["icon"])]),_:1},512)]),_:1})],64)),T.value&&V.value?(v(),z(O,{key:2,label:"音乐信息"},{default:a(()=>[s("div",lo,[s("div",no,d(V.value.title)+" - "+d(V.value.author),1),V.value.album?(v(),y("div",io,"专辑："+d(V.value.album),1)):$("",!0),V.value.tagList&&_(fe)(V.value.tagList).length?(v(),y("div",ro,[e[44]||(e[44]=f(" 标签： ",-1)),(v(!0),y(se,null,ye(_(fe)(V.value.tagList),o=>(v(),z(E,{key:o,size:"small",class:"music-tag"},{default:a(()=>[f(d(o),1)]),_:2},1024))),128))])):$("",!0)])]),_:1})):(v(),z(O,{key:3,label:"音乐信息"},{default:a(()=>[s("div",uo,[l(te,{title:"请先选择音乐",type:"warning",closable:!1,"show-icon":""},{default:a(()=>e[45]||(e[45]=[s("p",null,"添加监控视频前，请先在音乐管理页面选择要监控的音乐",-1)])),_:1})])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(de,{modelValue:K.value,"onUpdate:modelValue":e[15]||(e[15]=o=>K.value=o),title:"批量操作",width:"400px"},{footer:a(()=>[l(p,{onClick:e[12]||(e[12]=o=>K.value=!1)},{default:a(()=>e[47]||(e[47]=[f("取消",-1)])),_:1,__:[47]}),l(p,{type:"success",onClick:e[13]||(e[13]=o=>Ee(1))},{default:a(()=>e[48]||(e[48]=[f(" 批量启用 ",-1)])),_:1,__:[48]}),l(p,{type:"warning",onClick:e[14]||(e[14]=o=>Ee(0))},{default:a(()=>e[49]||(e[49]=[f(" 批量停用 ",-1)])),_:1,__:[49]}),l(p,{type:"danger",onClick:tt},{default:a(()=>e[50]||(e[50]=[f(" 批量删除 ",-1)])),_:1,__:[50]})]),default:a(()=>[s("p",null,"已选择 "+d(U.value.length)+" 个监控项",1)]),_:1},8,["modelValue"]),l(de,{modelValue:ie.value,"onUpdate:modelValue":e[16]||(e[16]=o=>ie.value=o),title:"导入进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:Ce},{footer:a(()=>[l(p,{onClick:Ce,disabled:h.value.status==="PROCESSING"},{default:a(()=>[f(d(h.value.status==="PROCESSING"?"处理中...":"关闭"),1)]),_:1},8,["disabled"])]),default:a(()=>[s("div",co,[s("div",mo,[s("p",null,[e[51]||(e[51]=s("strong",null,"文件名：",-1)),f(d(h.value.fileName),1)]),s("p",null,[e[52]||(e[52]=s("strong",null,"任务ID：",-1)),f(d(h.value.id),1)]),s("p",null,[e[53]||(e[53]=s("strong",null,"状态：",-1)),l(E,{type:Xe(h.value.status),size:"small"},{default:a(()=>[f(d(We(h.value.status)),1)]),_:1},8,["type"])])]),s("div",fo,[l(rt,{percentage:h.value.progress,status:h.value.status==="COMPLETED"?"success":h.value.status==="FAILED"?"exception":null},null,8,["percentage","status"]),h.value.totalCount>0?(v(),y("div",vo,[s("div",po,[s("span",null,"总计："+d(h.value.totalCount),1),s("span",null,"已处理："+d(h.value.processedCount),1)]),s("div",_o,[s("span",go,"成功："+d(h.value.successCount),1),s("span",yo,"跳过："+d(h.value.skipCount),1),s("span",ho,"失败："+d(h.value.errorCount),1)])])):$("",!0)]),h.value.status==="PROCESSING"?(v(),y("div",wo,[l(n,{class:"rotating"},{default:a(()=>[l(_(Ft))]),_:1}),e[54]||(e[54]=s("span",null,"正在处理中，请稍候...",-1))])):$("",!0),h.value.status==="COMPLETED"?(v(),y("div",Io,[l(n,{style:{color:"#67c23a"}},{default:a(()=>[l(_(Ae))]),_:1}),e[55]||(e[55]=s("span",null,"导入完成！",-1))])):$("",!0),h.value.status==="FAILED"?(v(),y("div",ko,[l(n,{style:{color:"#f56c6c"}},{default:a(()=>[l(_(Ot))]),_:1}),e[56]||(e[56]=s("span",null,"导入失败，请重试",-1))])):$("",!0)])]),_:1},8,["modelValue"]),l(de,{modelValue:Y.value,"onUpdate:modelValue":e[19]||(e[19]=o=>Y.value=o),title:"更新邮箱",width:"420px"},{footer:a(()=>[l(p,{onClick:e[18]||(e[18]=o=>Y.value=!1)},{default:a(()=>e[57]||(e[57]=[f("取消",-1)])),_:1,__:[57]}),l(p,{type:"primary",loading:_e.value,onClick:at},{default:a(()=>e[58]||(e[58]=[f("确定",-1)])),_:1,__:[58]},8,["loading"])]),default:a(()=>[l(Ve,{model:Z.value,"label-width":"80px"},{default:a(()=>[l(O,{label:"邮箱"},{default:a(()=>[l(A,{modelValue:Z.value.email,"onUpdate:modelValue":e[17]||(e[17]=o=>Z.value.email=o),placeholder:"请输入新的邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Fo=ns(xo,[["__scopeId","data-v-2df3a19b"]]);export{Fo as default};
