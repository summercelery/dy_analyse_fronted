/* empty css                  *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                        *//* empty css                  *//* empty css               *//* empty css                 */import{u as ce,a as me,r as _,n as _e,p as pe,o as f,c as V,d as o,e as a,w as l,t as c,s as u,x as i,y as R,z as fe,B as ve,C as ge,k as he,i as we,U as be,a0 as ye,h as m,G as Ce,J as Ve,a5 as ke,a6 as S,v as Ee,N as K,O as j,$ as G,Z as J,I as Me,aq as xe,ab as Le,g as Te,A as De,P as Ae,Q as Ie,R as Ne,ai as Be,T as $e,ah as ze,ak as Fe,j as Ue,l as qe,F as Re}from"./index-ea0ef51f.js";import{m as x}from"./music-cb72a1f9.js";import{p as D,v as Se,s as Ke,i as je,a as Ge}from"./tagUtils-dd34c03c.js";import{_ as Je}from"./_plugin-vue_export-helper-c27b6911.js";const Oe={class:"music-layout"},Pe={class:"header"},Qe={class:"header-right"},Ze={class:"user-info"},He={class:"username"},We={class:"main-container"},Xe={class:"sidebar"},Ye={class:"content"},et={class:"toolbar"},tt={class:"toolbar-left"},at={class:"toolbar-right"},lt={class:"music-id"},st={class:"music-title"},ot={class:"music-author"},nt={class:"music-album"},rt={class:"music-tags"},it={key:0,class:"na-text"},ut={class:"table-actions"},dt={class:"tag-input-container"},ct={key:0,class:"tag-list"},mt={__name:"Music",setup(_t){const B=ce(),A=me(),g=_(!1),I=_(!1),L=_([]),h=_(""),w=_(!1),b=_(null),k=_(),r=_({id:null,title:"",author:"",album:"",tags:[]}),y=_(""),O={title:[{required:!0,message:"请输入音乐标题",trigger:"blur"}],author:[{required:!0,message:"请输入作者名称",trigger:"blur"}],album:[{required:!0,message:"请输入专辑名称",trigger:"blur"}],tags:[{validator:(t,e,n)=>{e.length>10?n(new Error("标签数量不能超过10个")):e.some(C=>C.length>20)?n(new Error("单个标签长度不能超过20个字符")):n()},trigger:"change"}]},$=_e(()=>{if(!h.value)return L.value;const t=h.value.toLowerCase();return L.value.filter(e=>{const n=D(e.tagList);return(e.title||"").toLowerCase().includes(t)||(e.author||"").toLowerCase().includes(t)||(e.album||"").toLowerCase().includes(t)||n.some(C=>C.toLowerCase().includes(t))})}),P=t=>t?new Date(t).toLocaleString("zh-CN"):"N/A",E=async()=>{g.value=!0;try{const t=await x.getMusicList();t.code===200?L.value=t.data||[]:i.error(t.message||"加载音乐列表失败")}catch(t){console.error("加载音乐列表失败:",t),i.error("加载音乐列表失败")}finally{g.value=!1}},Q=async()=>{if(!h.value.trim()){await E();return}g.value=!0;try{const t=await x.searchMusicExtended(h.value.trim());t.code===200?L.value=t.data||[]:i.error(t.message||"搜索失败")}catch(t){console.error("搜索失败:",t),i.error("搜索失败")}finally{g.value=!1}},z=()=>{b.value=null,r.value={id:null,title:"",author:"",album:"",tags:[]},y.value="",k.value&&k.value.resetFields()},Z=t=>{b.value=t,r.value={id:t.id,title:t.title||"",author:t.author||"",album:t.album||"",tags:D(t.tagList)},w.value=!0},H=async()=>{if(!k.value)return;try{await k.value.validate()}catch{return}const t=Se(r.value.tags);if(!t.valid){i.warning(t.message);return}I.value=!0;try{const e={...r.value,tagList:Ke(r.value.tags)};let n;b.value?n=await x.updateMusic(e):n=await x.addMusic(e),n.code===200?(i.success(b.value?"更新音乐成功":"添加音乐成功"),w.value=!1,z(),await E()):i.error(n.message||"操作失败")}catch(e){console.error("操作失败:",e),i.error("操作失败")}finally{I.value=!1}},W=async t=>{var e;try{await R.confirm(`确认删除音乐"${t.title}"？删除后无法恢复`,"警告",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"});const n=await x.deleteMusic(t.id);n.code===200?(i.success("删除成功"),await E()):(e=n.message)!=null&&e.includes("歌曲信息不存在")?(i.error("该音乐不存在或已被删除"),await E()):i.error(n.message||"删除失败")}catch(n){n!=="cancel"&&(console.error("删除失败:",n),i.error("删除失败"))}},X=async t=>{if(t==="logout")try{await R.confirm("确认退出登录？","提示",{type:"warning"}),await A.logout(),B.push("/login")}catch{}},Y=t=>{B.push({path:"/monitor",query:{musicId:t.id}})},F=()=>{const t=y.value.trim();if(!t){i.warning("请输入标签内容");return}if(!je(t)){i.warning("标签长度应在1-20个字符之间");return}if(r.value.tags.length>=10){i.warning("标签数量不能超过10个");return}if(Ge(r.value.tags,t)){i.warning("标签已存在");return}r.value.tags.push(t),y.value="",i.success("标签添加成功")},ee=t=>{r.value.tags.splice(t,1)};return pe(()=>{E()}),(t,e)=>{var q;const n=fe,C=De,te=Ae,ae=Ie,le=ve,se=Ne,oe=ge,p=he,M=we,v=Be,U=$e,N=ze,ne=Fe,re=be,T=Ue,ie=qe,ue=ye,de=Re;return f(),V("div",Oe,[o("header",Pe,[e[9]||(e[9]=o("div",{class:"header-left"},[o("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),o("div",Qe,[o("div",Ze,[a(n,{size:32,class:"user-avatar"},{default:l(()=>{var s,d;return[m(c((d=(s=u(A).user)==null?void 0:s.username)==null?void 0:d.charAt(0)),1)]}),_:1}),o("span",He,c((q=u(A).user)==null?void 0:q.username),1),a(le,{onCommand:X,class:"user-dropdown"},{dropdown:l(()=>[a(ae,null,{default:l(()=>[a(te,{command:"logout"},{default:l(()=>e[8]||(e[8]=[m("退出登录",-1)])),_:1,__:[8]})]),_:1})]),default:l(()=>[a(C,{class:"dropdown-icon"},{default:l(()=>[a(u(Ce))]),_:1})]),_:1})])])]),o("div",We,[o("nav",Xe,[a(oe,{"default-active":t.$route.path,router:"",class:"sidebar-menu"},{default:l(()=>[a(se,{index:"/music",class:"menu-item"},{default:l(()=>[a(C,null,{default:l(()=>[a(u(Ve))]),_:1}),e[10]||(e[10]=o("span",null,"音乐管理",-1))]),_:1,__:[10]})]),_:1},8,["default-active"])]),o("main",Ye,[e[14]||(e[14]=o("div",{class:"page-header"},[o("h2",{class:"page-title"},"音乐管理"),o("p",{class:"page-desc"},"管理系统中的音乐库，支持音乐的增删改查操作")],-1)),o("div",et,[o("div",tt,[a(p,{type:"primary",onClick:e[0]||(e[0]=s=>w.value=!0),icon:u(ke)},{default:l(()=>e[11]||(e[11]=[m(" 添加音乐 ",-1)])),_:1,__:[11]},8,["icon"])]),o("div",at,[a(M,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),placeholder:"搜索音乐标题、作者或专辑","prefix-icon":u(S),style:{width:"300px"},clearable:"",onInput:t.handleSearch},null,8,["modelValue","prefix-icon","onInput"]),a(p,{type:"primary",icon:u(S),onClick:Q,loading:g.value},{default:l(()=>e[12]||(e[12]=[m(" 搜索 ",-1)])),_:1,__:[12]},8,["icon","loading"])])]),a(re,{class:"music-table-card"},{header:l(()=>e[13]||(e[13]=[o("div",{class:"card-header"},[o("span",{class:"card-title"},"音乐列表")],-1)])),default:l(()=>[Ee((f(),V("div",null,[a(ne,{data:$.value,style:{width:"100%"},"empty-text":$.value.length===0?"暂无音乐数据":""},{default:l(()=>[a(v,{label:"ID",width:"80"},{default:l(({row:s})=>[o("span",lt,c(s.id),1)]),_:1}),a(v,{label:"音乐标题","min-width":"200"},{default:l(({row:s})=>[o("div",st,c(s.title||"N/A"),1)]),_:1}),a(v,{label:"作者","min-width":"150"},{default:l(({row:s})=>[o("div",ot,c(s.author||"N/A"),1)]),_:1}),a(v,{label:"专辑","min-width":"150"},{default:l(({row:s})=>[o("div",nt,c(s.album||"N/A"),1)]),_:1}),a(v,{label:"标签","min-width":"150"},{default:l(({row:s})=>[o("div",rt,[(f(!0),V(K,null,j(u(D)(s.tagList),d=>(f(),G(U,{key:d,size:"small",style:{"margin-right":"5px"}},{default:l(()=>[m(c(d),1)]),_:2},1024))),128)),u(D)(s.tagList).length?J("",!0):(f(),V("span",it,"N/A"))])]),_:1}),a(v,{label:"创建时间",width:"180"},{default:l(({row:s})=>[m(c(P(s.createTime)),1)]),_:1}),a(v,{label:"操作",width:"200",fixed:"right"},{default:l(({row:s})=>[o("div",ut,[a(N,{content:"查看详情",placement:"top"},{default:l(()=>[a(p,{type:"primary",size:"small",icon:u(Me),onClick:d=>Y(s),link:""},null,8,["icon","onClick"])]),_:2},1024),a(N,{content:"编辑音乐",placement:"top"},{default:l(()=>[a(p,{type:"primary",size:"small",icon:u(xe),onClick:d=>Z(s),link:""},null,8,["icon","onClick"])]),_:2},1024),a(N,{content:"删除音乐",placement:"top"},{default:l(()=>[a(p,{type:"danger",size:"small",icon:u(Le),onClick:d=>W(s),link:""},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data","empty-text"])])),[[de,g.value]])]),_:1})])]),a(ue,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=s=>w.value=s),title:b.value?"编辑音乐":"添加音乐",width:"500px",onClose:z},{footer:l(()=>[a(p,{onClick:e[6]||(e[6]=s=>w.value=!1)},{default:l(()=>e[17]||(e[17]=[m("取消",-1)])),_:1,__:[17]}),a(p,{type:"primary",onClick:H,loading:I.value},{default:l(()=>[m(c(b.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:l(()=>[a(ie,{model:r.value,rules:O,ref_key:"formRef",ref:k,"label-width":"100px"},{default:l(()=>[a(T,{label:"音乐标题",prop:"title"},{default:l(()=>[a(M,{modelValue:r.value.title,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.title=s),placeholder:"请输入音乐标题"},null,8,["modelValue"])]),_:1}),a(T,{label:"作者",prop:"author"},{default:l(()=>[a(M,{modelValue:r.value.author,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.author=s),placeholder:"请输入作者名称"},null,8,["modelValue"])]),_:1}),a(T,{label:"专辑",prop:"album"},{default:l(()=>[a(M,{modelValue:r.value.album,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.album=s),placeholder:"请输入专辑名称"},null,8,["modelValue"])]),_:1}),a(T,{label:"搜索标签",prop:"tags"},{default:l(()=>[o("div",dt,[a(M,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),placeholder:"输入标签后按回车添加",onKeyup:Te(F,["enter"]),class:"tag-input"},{append:l(()=>[a(p,{onClick:F,disabled:!y.value.trim()},{default:l(()=>e[15]||(e[15]=[m("添加",-1)])),_:1,__:[15]},8,["disabled"])]),_:1},8,["modelValue"]),r.value.tags.length>0?(f(),V("div",ct,[(f(!0),V(K,null,j(r.value.tags,(s,d)=>(f(),G(U,{key:d,closable:"",onClose:pt=>ee(d),class:"music-tag"},{default:l(()=>[m(c(s),1)]),_:2},1032,["onClose"]))),128))])):J("",!0),e[16]||(e[16]=o("div",{class:"tag-tips"},[o("small",null,"提示：此标签用于抖音搜索,将自动监控标签下top50短视频")],-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Lt=Je(mt,[["__scopeId","data-v-5fbbfb0e"]]);export{Lt as default};
