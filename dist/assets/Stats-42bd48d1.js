import{_ as de}from"./_plugin-vue_export-helper-d6af9df2.js";/* empty css                  *//* empty css                     *//* empty css                     */import{v as J,H as ue}from"./index.esm.min-ebfc7aa3.js";import{p as ce,u as me,a as ve,r as p,aC as pe,q as _e,o as u,c as g,d as t,e as l,w as a,t as m,v,Y as fe,z as c,y as h,B as C,C as ge,D as ye,G as be,H as we,I as he,aD as Ce,k as ke,J as Se,L as Ee,M as $e,ay as De,h as _,N as xe,O as Ae,P as Ve,U as Ie,W as Le,A as $,a9 as I,a0 as Me,a2 as Ue,aa as ze,ac as Be,ad as Ne,ae as Fe,af as Oe,aE as Te,ah as je,aj as He,i as Pe,j as Re,l as qe}from"./index-0e04f23d.js";import{u as Ge,i as Je,a as We,b as Ye,c as Ke,d as Qe,e as Xe}from"./install-6e609d49.js";const Ze={class:"stats-layout"},et={class:"header"},tt={class:"header-right"},st={class:"user-info"},lt={class:"username"},at={class:"main-container"},ot={class:"sidebar"},nt={class:"content"},it={class:"page-header"},rt={class:"page-breadcrumb"},dt={class:"page-info"},ut={class:"page-desc"},ct={class:"toolbar"},mt={class:"toolbar-left"},vt={class:"toolbar-right"},pt={class:"stats-content"},_t={key:0,class:"stats-grid"},ft={class:"stat-info"},gt={class:"stat-value"},yt={key:0,class:"stat-trend"},bt={class:"stat-icon"},wt={class:"stat-info"},ht={class:"stat-value"},Ct={key:0,class:"stat-trend"},kt={class:"stat-icon"},St={class:"stat-info"},Et={class:"stat-value"},$t={key:0,class:"stat-trend"},Dt={class:"stat-icon"},xt={class:"stat-info"},At={class:"stat-value"},Vt={key:0,class:"stat-trend"},It={class:"card-header"},Lt={class:"chart-legend"},Mt={class:"chart-container"},Ut={key:1,class:"empty-chart"},zt={__name:"Stats",setup(Bt){Ge([Je,We,Ye,Ke,Qe,Xe]);const T=ce(),W=me(),y=ve(),k=p(!1),b=p(null),L=p("7"),D=p(null),M=p(null),n=p({digg:0,comment:0,collect:0,share:0}),d=p({likes:!0,comments:!0,collects:!0,shares:!0}),j=T.params.awemeId,S=p(!1),U=p(!1),E=p({email:""}),x=s=>s?s>=1e4?(s/1e4).toFixed(1)+"w":s.toString():"0",A=s=>{if(!s)return Date.now();try{const e=s.split(" ");if(e.length===3){const i=e[0],o=e[1]+" "+e[2],w=`${i}-${o}`;return new Date(w).getTime()}return new Date(s).getTime()}catch(e){return console.error("时间解析失败:",s,e),Date.now()}},f=s=>{d.value[s]=!d.value[s],Object.values(d.value).every(i=>!i)&&(d.value[s]=!0),M.value&&P(M.value)},Y=async()=>{try{const s=await J.getLatestVideoStats(j);s.code===200&&(b.value=s.data)}catch(s){console.error("加载最新统计失败:",s)}},H=async()=>{try{const s=await J.getVideoStatsChart(j,L.value);s.code===200&&(M.value=s.data,P(s.data))}catch{C.error("加载图表数据失败")}},P=s=>{if(!s||!s.timestamps){D.value=null;return}console.log("原始数据:",s),console.log("时间戳数据:",s.timestamps),console.log("点赞数据:",s.diggCounts);const e=[];d.value.likes&&e.push({name:"点赞数",type:"line",data:(s.diggCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#ff6b9d"},itemStyle:{color:"#ff6b9d"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255, 107, 157, 0.3)"},{offset:1,color:"rgba(255, 107, 157, 0.05)"}]}}}),d.value.comments&&e.push({name:"评论数",type:"line",data:(s.commentCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#4ecdc4"},itemStyle:{color:"#4ecdc4"}}),d.value.collects&&e.push({name:"收藏数",type:"line",data:(s.collectCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#45b7d1"},itemStyle:{color:"#45b7d1"}}),d.value.shares&&e.push({name:"分享数",type:"line",data:(s.shareCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#f9ca24"},itemStyle:{color:"#f9ca24"}}),D.value={tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"rgba(50, 50, 50, 0.95)",borderColor:"transparent",textStyle:{color:"#fff"}},grid:{left:"2%",right:"2%",bottom:"8%",top:"5%",containLabel:!0},xAxis:{type:"time",axisLine:{lineStyle:{color:"#e6e8eb"}},axisLabel:{color:"#6b7280",formatter:i=>{const o=new Date(i),w=(o.getMonth()+1).toString().padStart(2,"0"),B=o.getDate().toString().padStart(2,"0"),N=o.getHours().toString().padStart(2,"0");return`${w}-${B} ${N}:00`}},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#e6e8eb"}},axisLabel:{color:"#6b7280",formatter:i=>i>=1e4?(i/1e4).toFixed(1)+"w":i},splitLine:{lineStyle:{color:"#f1f3f4",type:"dashed"}}},series:e}},K=async s=>{var e;if(s==="updateEmail"){E.value.email=((e=y.user)==null?void 0:e.email)||"",S.value=!0;return}if(s==="logout")try{await ge.confirm("确认退出登录？","提示",{type:"warning"}),await y.logout(),W.push("/login")}catch{}},Q=s=>/^[\w.!#$%&'*+/=?^`{|}~-]+@[\w-]+(\.[\w-]+)+$/.test(s),X=async()=>{const s=(E.value.email||"").trim();if(!s){C.warning("请输入邮箱地址");return}if(!Q(s)){C.warning("邮箱格式不正确");return}U.value=!0;try{const e=await Be.updateEmail({email:s});e.code===200?(y.setUser({...y.user||{},email:s}),C.success("邮箱更新成功"),S.value=!1):C.error(e.message||"邮箱更新失败")}catch{C.error("邮箱更新失败，请稍后重试")}finally{U.value=!1}},z=async()=>{k.value=!0;try{await Promise.all([Y(),H()])}finally{k.value=!1}};return pe(()=>T.params.awemeId,s=>{s&&z()}),_e(()=>{z()}),(s,e)=>{var q;const i=ye,o=be,w=Ne,B=Fe,N=we,R=Oe,Z=he,F=Te,ee=Ce,V=ke,O=je,te=Se,se=He,le=Ee,ae=Pe,oe=Re,ne=qe,ie=$e,re=De;return u(),g("div",Ze,[t("header",et,[e[17]||(e[17]=t("div",{class:"header-left"},[t("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),t("div",tt,[t("div",st,[l(i,{size:32,class:"user-avatar"},{default:a(()=>{var r,G;return[_(m((G=(r=v(y).user)==null?void 0:r.username)==null?void 0:G.charAt(0)),1)]}),_:1}),t("span",lt,m((q=v(y).user)==null?void 0:q.username),1),l(N,{onCommand:K,class:"user-dropdown"},{dropdown:a(()=>[l(B,null,{default:a(()=>[l(w,{command:"updateEmail"},{default:a(()=>e[15]||(e[15]=[_("更新邮箱",-1)])),_:1,__:[15]}),l(w,{command:"logout"},{default:a(()=>e[16]||(e[16]=[_("退出登录",-1)])),_:1,__:[16]})]),_:1})]),default:a(()=>[l(o,{class:"dropdown-icon"},{default:a(()=>[l(v(xe))]),_:1})]),_:1})])])]),t("div",at,[t("nav",ot,[l(Z,{"default-active":"/music",router:"",class:"sidebar-menu"},{default:a(()=>[l(R,{index:"/music",class:"menu-item"},{default:a(()=>[l(o,null,{default:a(()=>[l(v(Ae))]),_:1}),e[18]||(e[18]=t("span",null,"音乐管理",-1))]),_:1,__:[18]}),l(R,{index:"/favorite-author",class:"menu-item"},{default:a(()=>[l(o,null,{default:a(()=>[l(v(Ve))]),_:1}),e[19]||(e[19]=t("span",null,"收藏播主",-1))]),_:1,__:[19]})]),_:1})]),t("main",nt,[t("div",it,[t("div",rt,[l(ee,{separator:"/"},{default:a(()=>[l(F,{onClick:e[0]||(e[0]=r=>s.$router.push("/music")),class:"breadcrumb-link"},{default:a(()=>e[20]||(e[20]=[_(" 音乐管理 ",-1)])),_:1,__:[20]}),l(F,{onClick:e[1]||(e[1]=r=>s.$router.push("/monitor")),class:"breadcrumb-link"},{default:a(()=>e[21]||(e[21]=[_(" 监控管理 ",-1)])),_:1,__:[21]}),l(F,null,{default:a(()=>e[22]||(e[22]=[_("视频统计",-1)])),_:1,__:[22]})]),_:1})]),t("div",dt,[e[23]||(e[23]=t("h2",{class:"page-title"},"视频数据统计",-1)),t("p",ut,"视频ID: "+m(s.$route.params.awemeId),1)])]),t("div",ct,[t("div",mt,[l(V,{onClick:e[2]||(e[2]=r=>s.$router.back()),icon:v(Ie)},{default:a(()=>e[24]||(e[24]=[_(" 返回 ",-1)])),_:1,__:[24]},8,["icon"]),l(V,{onClick:z,loading:k.value,icon:v(Le)},{default:a(()=>e[25]||(e[25]=[_(" 刷新数据 ",-1)])),_:1,__:[25]},8,["loading","icon"])]),t("div",vt,[l(te,{modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=r=>L.value=r),placeholder:"选择时间范围",style:{width:"140px"},onChange:H},{default:a(()=>[l(O,{label:"最近7天",value:"7"}),l(O,{label:"最近15天",value:"15"}),l(O,{label:"最近30天",value:"30"})]),_:1},8,["modelValue"])])]),fe((u(),g("div",pt,[b.value?(u(),g("div",_t,[t("div",{class:c(["stat-card likes",{"is-active":d.value.likes}]),onClick:e[4]||(e[4]=r=>f("likes"))},[e[27]||(e[27]=t("div",{class:"stat-icon"},[t("div",{class:"heart-icon-large"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})])])],-1)),t("div",ft,[t("div",gt,m(x(b.value.diggCount)),1),e[26]||(e[26]=t("div",{class:"stat-label"},"点赞数",-1)),n.value.digg?(u(),g("div",yt,[l(o,{class:c({"trend-up":n.value.digg>0,"trend-down":n.value.digg<0})},{default:a(()=>[(u(),$(I(n.value.digg>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.digg))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card comments",{"is-active":d.value.comments}]),onClick:e[5]||(e[5]=r=>f("comments"))},[t("div",bt,[l(o,{size:"24"},{default:a(()=>[l(v(Me))]),_:1})]),t("div",wt,[t("div",ht,m(x(b.value.commentCount)),1),e[28]||(e[28]=t("div",{class:"stat-label"},"评论数",-1)),n.value.comment?(u(),g("div",Ct,[l(o,{class:c({"trend-up":n.value.comment>0,"trend-down":n.value.comment<0})},{default:a(()=>[(u(),$(I(n.value.comment>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.comment))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card collects",{"is-active":d.value.collects}]),onClick:e[6]||(e[6]=r=>f("collects"))},[t("div",kt,[l(o,{size:"24"},{default:a(()=>[l(v(Ue))]),_:1})]),t("div",St,[t("div",Et,m(x(b.value.collectCount)),1),e[29]||(e[29]=t("div",{class:"stat-label"},"收藏数",-1)),n.value.collect?(u(),g("div",$t,[l(o,{class:c({"trend-up":n.value.collect>0,"trend-down":n.value.collect<0})},{default:a(()=>[(u(),$(I(n.value.collect>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.collect))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card shares",{"is-active":d.value.shares}]),onClick:e[7]||(e[7]=r=>f("shares"))},[t("div",Dt,[l(o,{size:"24"},{default:a(()=>[l(v(ze))]),_:1})]),t("div",xt,[t("div",At,m(x(b.value.shareCount)),1),e[30]||(e[30]=t("div",{class:"stat-label"},"分享数",-1)),n.value.share?(u(),g("div",Vt,[l(o,{class:c({"trend-up":n.value.share>0,"trend-down":n.value.share<0})},{default:a(()=>[(u(),$(I(n.value.share>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.share))+"%",1)])):h("",!0)])],2)])):h("",!0),l(le,{class:"chart-card"},{header:a(()=>[t("div",It,[e[35]||(e[35]=t("span",{class:"card-title"},"数据趋势图",-1)),t("div",Lt,[t("div",{class:c(["legend-item",{"legend-disabled":!d.value.likes}]),onClick:e[8]||(e[8]=r=>f("likes"))},e[31]||(e[31]=[t("div",{class:"legend-dot likes-dot"},null,-1),t("span",null,"点赞",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.comments}]),onClick:e[9]||(e[9]=r=>f("comments"))},e[32]||(e[32]=[t("div",{class:"legend-dot comments-dot"},null,-1),t("span",null,"评论",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.collects}]),onClick:e[10]||(e[10]=r=>f("collects"))},e[33]||(e[33]=[t("div",{class:"legend-dot collects-dot"},null,-1),t("span",null,"收藏",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.shares}]),onClick:e[11]||(e[11]=r=>f("shares"))},e[34]||(e[34]=[t("div",{class:"legend-dot shares-dot"},null,-1),t("span",null,"分享",-1)]),2)])])]),default:a(()=>[t("div",Mt,[D.value?(u(),$(v(ue),{key:0,option:D.value,style:{height:"450px"},autoresize:""},null,8,["option"])):k.value?h("",!0):(u(),g("div",Ut,[l(se,{description:"暂无图表数据"})]))])]),_:1})])),[[re,k.value]])])]),l(ie,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=r=>S.value=r),title:"更新邮箱",width:"420px"},{footer:a(()=>[l(V,{onClick:e[13]||(e[13]=r=>S.value=!1)},{default:a(()=>e[36]||(e[36]=[_("取消",-1)])),_:1,__:[36]}),l(V,{type:"primary",loading:U.value,onClick:X},{default:a(()=>e[37]||(e[37]=[_("确定",-1)])),_:1,__:[37]},8,["loading"])]),default:a(()=>[l(ne,{model:E.value,"label-width":"80px"},{default:a(()=>[l(oe,{label:"邮箱"},{default:a(()=>[l(ae,{modelValue:E.value.email,"onUpdate:modelValue":e[12]||(e[12]=r=>E.value.email=r),placeholder:"请输入新的邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Rt=de(zt,[["__scopeId","data-v-23d0988a"]]);export{Rt as default};
