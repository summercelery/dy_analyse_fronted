/* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css               *//* empty css                 *//* empty css                           */import{u as Dt,X as Tt,a as xt,r as g,n as M,p as Bt,q as r,o as u,c as p,d as e,e as s,w as n,t as l,s as R,Z as D,N as et,O as st,_ as T,$ as ot,x,y as Lt,z as $t,A as Nt,B as Ut,C as At,as as Rt,k as Pt,i as Ft,at as Ot,ak as Gt,h as d,f as at,P as Ht,Q as Wt,R as qt,au as Kt,T as Qt,ah as Xt,ai as Zt,S as jt}from"./index-ea0ef51f.js";import{m as nt}from"./music-cb72a1f9.js";import{v as Jt}from"./video-68f2c7a4.js";import{p as Yt}from"./tagUtils-dd34c03c.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const ee={class:"music-detail-layout"},se={class:"header"},oe={class:"header-right"},ae={class:"user-info"},ne={class:"username"},le={class:"main-container"},ie={class:"sidebar"},de={class:"content"},re={class:"breadcrumb-container"},ce={key:0,class:"music-info-card"},ue={class:"music-info-header"},_e={class:"music-icon"},me={class:"music-details"},pe={class:"music-title"},ve={class:"music-meta"},fe={class:"music-author"},he={key:0,class:"music-album"},ge={key:0,class:"music-tags"},we={class:"music-actions"},ye={class:"search-bar"},be={class:"stats-row"},Ce={class:"stat-icon"},ke={class:"stat-info"},Ie={class:"stat-value"},Me={class:"stat-icon"},Ve={class:"stat-info"},Ee={class:"stat-value"},Se={class:"stat-icon"},ze={class:"stat-info"},De={class:"stat-value"},Te={class:"stat-icon"},xe={class:"stat-info"},Be={class:"stat-value"},Le={class:"monitor-list-card"},$e={class:"card-header"},Ne={class:"card-actions"},Ue={key:0,class:"video-grid"},Ae=["onClick"],Re={class:"video-header"},Pe={class:"video-status"},Fe={class:"video-actions"},Oe={class:"video-content"},Ge={class:"video-id"},He=["title"],We={class:"video-time"},qe={class:"video-stats"},Ke={class:"stat-item"},Qe={class:"stat-item"},Xe={class:"stat-item"},Ze={class:"stat-item"},je={class:"video-footer"},Je={class:"video-dates"},Ye={class:"create-time"},ts={key:1,class:"video-table"},es={class:"video-id-text"},ss={class:"video-url-text"},os={class:"stat-number"},as={class:"stat-number"},ns={class:"stat-number"},ls={class:"stat-number"},is={__name:"MusicMonitorDetail",setup(ds){const B=Dt(),P=Tt(),L=xt(),b=g(!1),m=g(null),h=g([]),$=g(new Map),V=g(""),C=g("grid"),w=g("all"),N=M(()=>h.value),F=M(()=>h.value.filter(o=>o.status===1)),O=M(()=>h.value.filter(o=>o.status===2||o.status===3)),G=M(()=>h.value.filter(o=>o.type===0)),U=M(()=>{let o=[];switch(w.value){case"all":o=N.value;break;case"monitoring":o=F.value;break;case"error":o=O.value;break;case"auto":o=G.value;break;default:o=N.value}if(V.value){const t=V.value.toLowerCase();o=o.filter(_=>{var S,i;return((S=_.awemeId)==null?void 0:S.toLowerCase().includes(t))||((i=_.videoUrl)==null?void 0:i.toLowerCase().includes(t))})}return o}),lt=async()=>{const o=P.params.musicId;if(o)try{const t=await nt.getMusicById(o);t.code===200?m.value=t.data:x.error(t.message||"获取音乐信息失败")}catch(t){console.error("获取音乐信息失败:",t),x.error("获取音乐信息失败")}},H=async()=>{const o=P.params.musicId;if(o){b.value=!0;try{const t=await nt.getMonitorVideosByMusicId(o);t.code===200?(h.value=t.data||[],await it()):x.error(t.message||"获取监控视频失败")}catch(t){console.error("获取监控视频失败:",t),x.error("获取监控视频失败")}finally{b.value=!1}}},it=async()=>{if(h.value.length===0)return;const o=h.value.map(async t=>{try{const _=await Jt.getLatestVideoStats(t.awemeId);_.code===200&&_.data&&$.value.set(t.awemeId,_.data)}catch(_){console.error(`获取视频 ${t.awemeId} 统计数据失败:`,_),$.value.set(t.awemeId,{diggCount:0,commentCount:0,collectCount:0,shareCount:0})}});await Promise.all(o)},v=o=>$.value.get(o)||{diggCount:0,commentCount:0,collectCount:0,shareCount:0},E=o=>{w.value=o},W=o=>{B.push(`/stats/${o}`)},q=o=>{window.open(o,"_blank")},dt=()=>{B.push("/music-monitor")},K=o=>({1:"success",0:"warning",2:"danger",3:"danger"})[o]||"info",Q=o=>({1:"监控中",0:"已停用",2:"已删除",3:"失败"})[o]||"未知",X=o=>o?o.length>50?o.substring(0,50)+"...":o:"",Z=o=>o?new Date(o).toLocaleDateString("zh-CN"):"-",j=o=>o?new Date(o*1e3).toLocaleDateString("zh-CN"):"-",f=o=>o==null?"0":o>=1e4?(o/1e4).toFixed(1)+"w":o>=1e3?(o/1e3).toFixed(1)+"k":o.toString(),rt=async o=>{if(o==="logout")try{await Lt.confirm("确认退出登录？","提示",{type:"warning"}),await L.logout(),B.push("/login")}catch{}};return Bt(()=>{lt(),H()}),(o,t)=>{var tt;const _=$t,S=r("ArrowDown"),i=Nt,ct=Ht,ut=Wt,_t=Ut,mt=r("Odometer"),z=qt,pt=r("View"),vt=r("Headset"),J=r("MusicNote"),ft=At,Y=Kt,ht=Rt,k=Qt,y=Pt,gt=Ft,wt=r("VideoCamera"),yt=r("CircleCheck"),bt=r("Warning"),Ct=r("MagicStick"),kt=Ot,A=Xt,It=r("Star"),Mt=r("ChatDotRound"),Vt=r("Collection"),Et=r("Share"),c=Zt,St=Gt,zt=jt;return u(),p("div",ee,[e("header",se,[t[9]||(t[9]=e("div",{class:"header-left"},[e("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),e("div",oe,[e("div",ae,[s(_,{size:32,class:"user-avatar"},{default:n(()=>{var a,I;return[d(l((I=(a=R(L).user)==null?void 0:a.username)==null?void 0:I.charAt(0)),1)]}),_:1}),e("span",ne,l((tt=R(L).user)==null?void 0:tt.username),1),s(_t,{onCommand:rt,class:"user-dropdown"},{dropdown:n(()=>[s(ut,null,{default:n(()=>[s(ct,{command:"logout"},{default:n(()=>t[8]||(t[8]=[d("退出登录",-1)])),_:1,__:[8]})]),_:1})]),default:n(()=>[s(i,{class:"dropdown-icon"},{default:n(()=>[s(S)]),_:1})]),_:1})])])]),e("div",le,[e("nav",ie,[s(ft,{"default-active":o.$route.path,router:"",class:"sidebar-menu"},{default:n(()=>[s(z,{index:"/dashboard",class:"menu-item"},{default:n(()=>[s(i,null,{default:n(()=>[s(mt)]),_:1}),t[10]||(t[10]=e("span",null,"数据概览",-1))]),_:1,__:[10]}),s(z,{index:"/monitor",class:"menu-item"},{default:n(()=>[s(i,null,{default:n(()=>[s(pt)]),_:1}),t[11]||(t[11]=e("span",null,"监控管理",-1))]),_:1,__:[11]}),s(z,{index:"/music-monitor",class:"menu-item"},{default:n(()=>[s(i,null,{default:n(()=>[s(vt)]),_:1}),t[12]||(t[12]=e("span",null,"音乐监控",-1))]),_:1,__:[12]}),s(z,{index:"/music",class:"menu-item"},{default:n(()=>[s(i,null,{default:n(()=>[s(J)]),_:1}),t[13]||(t[13]=e("span",null,"音乐管理",-1))]),_:1,__:[13]})]),_:1},8,["default-active"])]),e("main",de,[e("div",re,[s(ht,{separator:"/"},{default:n(()=>[s(Y,{to:{path:"/music-monitor"}},{default:n(()=>t[14]||(t[14]=[d("音乐监控",-1)])),_:1,__:[14]}),s(Y,null,{default:n(()=>{var a;return[d(l(((a=m.value)==null?void 0:a.title)||"音乐详情"),1)]}),_:1})]),_:1})]),m.value?(u(),p("div",ce,[e("div",ue,[e("div",_e,[s(i,{size:"32"},{default:n(()=>[s(J)]),_:1})]),e("div",me,[e("h2",pe,l(m.value.title),1),e("p",ve,[e("span",fe,l(m.value.author),1),m.value.album?(u(),p("span",he,"• "+l(m.value.album),1)):D("",!0)]),m.value.tagList?(u(),p("div",ge,[(u(!0),p(et,null,st(R(Yt)(m.value.tagList),a=>(u(),ot(k,{key:a,size:"small",class:"music-tag"},{default:n(()=>[d(l(a),1)]),_:2},1024))),128))])):D("",!0)]),e("div",we,[s(y,{onClick:dt,icon:o.ArrowLeft},{default:n(()=>t[15]||(t[15]=[d("返回",-1)])),_:1,__:[15]},8,["icon"]),s(y,{onClick:H,loading:b.value,icon:o.Refresh},{default:n(()=>t[16]||(t[16]=[d(" 刷新 ",-1)])),_:1,__:[16]},8,["loading","icon"])])])])):D("",!0),e("div",ye,[s(gt,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a),placeholder:"搜索视频ID或链接","prefix-icon":o.Search,style:{width:"400px"},clearable:"",size:"large"},null,8,["modelValue","prefix-icon"])]),e("div",be,[e("div",{class:T(["stat-card total",{active:w.value==="all"}]),onClick:t[1]||(t[1]=a=>E("all"))},[e("div",Ce,[s(i,{size:"20"},{default:n(()=>[s(wt)]),_:1})]),e("div",ke,[e("div",Ie,l(N.value.length),1),t[17]||(t[17]=e("div",{class:"stat-label"},"监控视频总数",-1))])],2),e("div",{class:T(["stat-card monitoring",{active:w.value==="monitoring"}]),onClick:t[2]||(t[2]=a=>E("monitoring"))},[e("div",Me,[s(i,{size:"20"},{default:n(()=>[s(yt)]),_:1})]),e("div",Ve,[e("div",Ee,l(F.value.length),1),t[18]||(t[18]=e("div",{class:"stat-label"},"监控中",-1))])],2),e("div",{class:T(["stat-card error",{active:w.value==="error"}]),onClick:t[3]||(t[3]=a=>E("error"))},[e("div",Se,[s(i,{size:"20"},{default:n(()=>[s(bt)]),_:1})]),e("div",ze,[e("div",De,l(O.value.length),1),t[19]||(t[19]=e("div",{class:"stat-label"},"异常监控",-1))])],2),e("div",{class:T(["stat-card auto",{active:w.value==="auto"}]),onClick:t[4]||(t[4]=a=>E("auto"))},[e("div",Te,[s(i,{size:"20"},{default:n(()=>[s(Ct)]),_:1})]),e("div",xe,[e("div",Be,l(G.value.length),1),t[20]||(t[20]=e("div",{class:"stat-label"},"自动添加",-1))])],2)]),e("div",Le,[e("div",$e,[t[23]||(t[23]=e("h3",{class:"card-title"},"监控视频列表",-1)),e("div",Ne,[s(kt,null,{default:n(()=>[s(y,{type:C.value==="grid"?"primary":"",onClick:t[5]||(t[5]=a=>C.value="grid"),icon:o.Grid},{default:n(()=>t[21]||(t[21]=[d(" 网格视图 ",-1)])),_:1,__:[21]},8,["type","icon"]),s(y,{type:C.value==="list"?"primary":"",onClick:t[6]||(t[6]=a=>C.value="list"),icon:o.List},{default:n(()=>t[22]||(t[22]=[d(" 列表视图 ",-1)])),_:1,__:[22]},8,["type","icon"])]),_:1})])]),C.value==="grid"?(u(),p("div",Ue,[(u(!0),p(et,null,st(U.value,a=>(u(),p("div",{key:a.id,class:"video-card",onClick:I=>W(a.awemeId)},[e("div",Re,[e("div",Pe,[s(k,{type:K(a.status),size:"small"},{default:n(()=>[d(l(Q(a.status)),1)]),_:2},1032,["type"]),s(k,{type:a.type===1?"primary":"info",size:"small"},{default:n(()=>[d(l(a.type===1?"手动":"自动"),1)]),_:2},1032,["type"])]),e("div",Fe,[s(A,{content:"打开视频",placement:"top"},{default:n(()=>[s(y,{type:"success",size:"small",icon:o.Link,circle:"",onClick:at(I=>q(a.videoUrl),["stop"])},null,8,["icon","onClick"])]),_:2},1024)])]),e("div",Oe,[e("div",Ge,l(a.awemeId),1),e("div",{class:"video-url",title:a.videoUrl},l(X(a.videoUrl)),9,He),e("div",We," 发布时间："+l(j(a.videoPublishTime)),1),e("div",qe,[e("div",Ke,[s(i,null,{default:n(()=>[s(It)]),_:1}),e("span",null,l(f(v(a.awemeId).diggCount)),1)]),e("div",Qe,[s(i,null,{default:n(()=>[s(Mt)]),_:1}),e("span",null,l(f(v(a.awemeId).commentCount)),1)]),e("div",Xe,[s(i,null,{default:n(()=>[s(Vt)]),_:1}),e("span",null,l(f(v(a.awemeId).collectCount)),1)]),e("div",Ze,[s(i,null,{default:n(()=>[s(Et)]),_:1}),e("span",null,l(f(v(a.awemeId).shareCount)),1)])])]),e("div",je,[e("div",Je,[e("div",Ye," 添加时间："+l(Z(a.createTime)),1)])])],8,Ae))),128))])):(u(),p("div",ts,[s(St,{data:U.value,style:{width:"100%"},loading:b.value,"empty-text":"暂无监控视频",onRowClick:t[7]||(t[7]=a=>W(a.awemeId)),class:"clickable-table"},{default:n(()=>[s(c,{prop:"awemeId",label:"视频ID",width:"180"},{default:n(({row:a})=>[e("span",es,l(a.awemeId),1)]),_:1}),s(c,{prop:"videoUrl",label:"视频链接","min-width":"200"},{default:n(({row:a})=>[s(A,{content:a.videoUrl,placement:"top"},{default:n(()=>[e("span",ss,l(X(a.videoUrl)),1)]),_:2},1032,["content"])]),_:1}),s(c,{prop:"type",label:"类型",width:"80"},{default:n(({row:a})=>[s(k,{type:a.type===1?"primary":"info",size:"small"},{default:n(()=>[d(l(a.type===1?"手动":"自动"),1)]),_:2},1032,["type"])]),_:1}),s(c,{prop:"status",label:"状态",width:"80"},{default:n(({row:a})=>[s(k,{type:K(a.status),size:"small"},{default:n(()=>[d(l(Q(a.status)),1)]),_:2},1032,["type"])]),_:1}),s(c,{prop:"videoPublishTime",label:"发布时间",width:"120"},{default:n(({row:a})=>[d(l(j(a.videoPublishTime)),1)]),_:1}),s(c,{prop:"createTime",label:"添加时间",width:"120"},{default:n(({row:a})=>[d(l(Z(a.createTime)),1)]),_:1}),s(c,{label:"点赞",width:"80"},{default:n(({row:a})=>[e("span",os,l(f(v(a.awemeId).diggCount)),1)]),_:1}),s(c,{label:"评论",width:"80"},{default:n(({row:a})=>[e("span",as,l(f(v(a.awemeId).commentCount)),1)]),_:1}),s(c,{label:"收藏",width:"80"},{default:n(({row:a})=>[e("span",ns,l(f(v(a.awemeId).collectCount)),1)]),_:1}),s(c,{label:"分享",width:"80"},{default:n(({row:a})=>[e("span",ls,l(f(v(a.awemeId).shareCount)),1)]),_:1}),s(c,{label:"操作",width:"80",fixed:"right"},{default:n(({row:a})=>[s(A,{content:"打开视频",placement:"top"},{default:n(()=>[s(y,{type:"success",size:"small",icon:o.Link,onClick:at(I=>q(a.videoUrl),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading"])])),!b.value&&U.value.length===0?(u(),ot(zt,{key:2,description:"该音乐暂无监控视频","image-size":120})):D("",!0)])])])])}}},bs=te(is,[["__scopeId","data-v-7b785bd2"]]);export{bs as default};
