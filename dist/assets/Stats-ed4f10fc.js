import{_ as de}from"./_plugin-vue_export-helper-d6af9df2.js";/* empty css                  *//* empty css                     */import{u as ue,i as ce,a as me,b as ve,c as pe,d as _e,e as fe}from"./install-c708aa89.js";import{v as G,H as ge}from"./index.esm.min-7eb9cc43.js";import{p as ye,u as be,a as we,r as v,ay as he,q as Ce,o as u,c as g,d as t,e as l,w as a,t as m,v as p,Y as ke,z as c,y as h,B as C,C as Se,D as Ee,G as $e,H as De,I as xe,az as Ae,k as Ve,J as Ie,L as ze,M as Le,at as Me,h as _,N as Ue,O as Be,U as Ne,W as Fe,A as $,a7 as I,Z as Oe,a1 as Te,a8 as He,a9 as je,aa as Pe,ab as Re,ac as qe,aA as Ge,ae as Je,ag as We,i as Ye,j as Ze,l as Ke}from"./index-a6d8c1ed.js";const Qe={class:"stats-layout"},Xe={class:"header"},et={class:"header-right"},tt={class:"user-info"},st={class:"username"},lt={class:"main-container"},at={class:"sidebar"},ot={class:"content"},nt={class:"page-header"},it={class:"page-breadcrumb"},rt={class:"page-info"},dt={class:"page-desc"},ut={class:"toolbar"},ct={class:"toolbar-left"},mt={class:"toolbar-right"},vt={class:"stats-content"},pt={key:0,class:"stats-grid"},_t={class:"stat-info"},ft={class:"stat-value"},gt={key:0,class:"stat-trend"},yt={class:"stat-icon"},bt={class:"stat-info"},wt={class:"stat-value"},ht={key:0,class:"stat-trend"},Ct={class:"stat-icon"},kt={class:"stat-info"},St={class:"stat-value"},Et={key:0,class:"stat-trend"},$t={class:"stat-icon"},Dt={class:"stat-info"},xt={class:"stat-value"},At={key:0,class:"stat-trend"},Vt={class:"card-header"},It={class:"chart-legend"},zt={class:"chart-container"},Lt={key:1,class:"empty-chart"},Mt={__name:"Stats",setup(Ut){ue([ce,me,ve,pe,_e,fe]);const T=ye(),J=be(),y=we(),k=v(!1),b=v(null),z=v("7"),D=v(null),L=v(null),n=v({digg:0,comment:0,collect:0,share:0}),d=v({likes:!0,comments:!0,collects:!0,shares:!0}),H=T.params.awemeId,S=v(!1),M=v(!1),E=v({email:""}),x=s=>s?s>=1e4?(s/1e4).toFixed(1)+"w":s.toString():"0",A=s=>{if(!s)return Date.now();try{const e=s.split(" ");if(e.length===3){const i=e[0],o=e[1]+" "+e[2],w=`${i}-${o}`;return new Date(w).getTime()}return new Date(s).getTime()}catch(e){return console.error("时间解析失败:",s,e),Date.now()}},f=s=>{d.value[s]=!d.value[s],Object.values(d.value).every(i=>!i)&&(d.value[s]=!0),L.value&&P(L.value)},W=async()=>{try{const s=await G.getLatestVideoStats(H);s.code===200&&(b.value=s.data)}catch(s){console.error("加载最新统计失败:",s)}},j=async()=>{try{const s=await G.getVideoStatsChart(H,z.value);s.code===200&&(L.value=s.data,P(s.data))}catch{C.error("加载图表数据失败")}},P=s=>{if(!s||!s.timestamps){D.value=null;return}console.log("原始数据:",s),console.log("时间戳数据:",s.timestamps),console.log("点赞数据:",s.diggCounts);const e=[];d.value.likes&&e.push({name:"点赞数",type:"line",data:(s.diggCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#ff6b9d"},itemStyle:{color:"#ff6b9d"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255, 107, 157, 0.3)"},{offset:1,color:"rgba(255, 107, 157, 0.05)"}]}}}),d.value.comments&&e.push({name:"评论数",type:"line",data:(s.commentCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#4ecdc4"},itemStyle:{color:"#4ecdc4"}}),d.value.collects&&e.push({name:"收藏数",type:"line",data:(s.collectCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#45b7d1"},itemStyle:{color:"#45b7d1"}}),d.value.shares&&e.push({name:"分享数",type:"line",data:(s.shareCounts||[]).map((i,o)=>[A(s.timestamps[o]),i]),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#f9ca24"},itemStyle:{color:"#f9ca24"}}),D.value={tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"rgba(50, 50, 50, 0.95)",borderColor:"transparent",textStyle:{color:"#fff"}},grid:{left:"2%",right:"2%",bottom:"8%",top:"5%",containLabel:!0},xAxis:{type:"time",axisLine:{lineStyle:{color:"#e6e8eb"}},axisLabel:{color:"#6b7280",formatter:i=>{const o=new Date(i),w=(o.getMonth()+1).toString().padStart(2,"0"),B=o.getDate().toString().padStart(2,"0"),N=o.getHours().toString().padStart(2,"0");return`${w}-${B} ${N}:00`}},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#e6e8eb"}},axisLabel:{color:"#6b7280",formatter:i=>i>=1e4?(i/1e4).toFixed(1)+"w":i},splitLine:{lineStyle:{color:"#f1f3f4",type:"dashed"}}},series:e}},Y=async s=>{var e;if(s==="updateEmail"){E.value.email=((e=y.user)==null?void 0:e.email)||"",S.value=!0;return}if(s==="logout")try{await Se.confirm("确认退出登录？","提示",{type:"warning"}),await y.logout(),J.push("/login")}catch{}},Z=s=>/^[\w.!#$%&'*+/=?^`{|}~-]+@[\w-]+(\.[\w-]+)+$/.test(s),K=async()=>{const s=(E.value.email||"").trim();if(!s){C.warning("请输入邮箱地址");return}if(!Z(s)){C.warning("邮箱格式不正确");return}M.value=!0;try{const e=await je.updateEmail({email:s});e.code===200?(y.setUser({...y.user||{},email:s}),C.success("邮箱更新成功"),S.value=!1):C.error(e.message||"邮箱更新失败")}catch{C.error("邮箱更新失败，请稍后重试")}finally{M.value=!1}},U=async()=>{k.value=!0;try{await Promise.all([W(),j()])}finally{k.value=!1}};return he(()=>T.params.awemeId,s=>{s&&U()}),Ce(()=>{U()}),(s,e)=>{var R;const i=Ee,o=$e,w=Pe,B=Re,N=De,Q=qe,X=xe,F=Ge,ee=Ae,V=Ve,O=Je,te=Ie,se=We,le=ze,ae=Ye,oe=Ze,ne=Ke,ie=Le,re=Me;return u(),g("div",Qe,[t("header",Xe,[e[17]||(e[17]=t("div",{class:"header-left"},[t("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),t("div",et,[t("div",tt,[l(i,{size:32,class:"user-avatar"},{default:a(()=>{var r,q;return[_(m((q=(r=p(y).user)==null?void 0:r.username)==null?void 0:q.charAt(0)),1)]}),_:1}),t("span",st,m((R=p(y).user)==null?void 0:R.username),1),l(N,{onCommand:Y,class:"user-dropdown"},{dropdown:a(()=>[l(B,null,{default:a(()=>[l(w,{command:"updateEmail"},{default:a(()=>e[15]||(e[15]=[_("更新邮箱",-1)])),_:1,__:[15]}),l(w,{command:"logout"},{default:a(()=>e[16]||(e[16]=[_("退出登录",-1)])),_:1,__:[16]})]),_:1})]),default:a(()=>[l(o,{class:"dropdown-icon"},{default:a(()=>[l(p(Ue))]),_:1})]),_:1})])])]),t("div",lt,[t("nav",at,[l(X,{"default-active":"/music",router:"",class:"sidebar-menu"},{default:a(()=>[l(Q,{index:"/music",class:"menu-item"},{default:a(()=>[l(o,null,{default:a(()=>[l(p(Be))]),_:1}),e[18]||(e[18]=t("span",null,"音乐管理",-1))]),_:1,__:[18]})]),_:1})]),t("main",ot,[t("div",nt,[t("div",it,[l(ee,{separator:"/"},{default:a(()=>[l(F,{onClick:e[0]||(e[0]=r=>s.$router.push("/music")),class:"breadcrumb-link"},{default:a(()=>e[19]||(e[19]=[_(" 音乐管理 ",-1)])),_:1,__:[19]}),l(F,{onClick:e[1]||(e[1]=r=>s.$router.push("/monitor")),class:"breadcrumb-link"},{default:a(()=>e[20]||(e[20]=[_(" 监控管理 ",-1)])),_:1,__:[20]}),l(F,null,{default:a(()=>e[21]||(e[21]=[_("视频统计",-1)])),_:1,__:[21]})]),_:1})]),t("div",rt,[e[22]||(e[22]=t("h2",{class:"page-title"},"视频数据统计",-1)),t("p",dt,"视频ID: "+m(s.$route.params.awemeId),1)])]),t("div",ut,[t("div",ct,[l(V,{onClick:e[2]||(e[2]=r=>s.$router.back()),icon:p(Ne)},{default:a(()=>e[23]||(e[23]=[_(" 返回 ",-1)])),_:1,__:[23]},8,["icon"]),l(V,{onClick:U,loading:k.value,icon:p(Fe)},{default:a(()=>e[24]||(e[24]=[_(" 刷新数据 ",-1)])),_:1,__:[24]},8,["loading","icon"])]),t("div",mt,[l(te,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=r=>z.value=r),placeholder:"选择时间范围",style:{width:"140px"},onChange:j},{default:a(()=>[l(O,{label:"最近7天",value:"7"}),l(O,{label:"最近15天",value:"15"}),l(O,{label:"最近30天",value:"30"})]),_:1},8,["modelValue"])])]),ke((u(),g("div",vt,[b.value?(u(),g("div",pt,[t("div",{class:c(["stat-card likes",{"is-active":d.value.likes}]),onClick:e[4]||(e[4]=r=>f("likes"))},[e[26]||(e[26]=t("div",{class:"stat-icon"},[t("div",{class:"heart-icon-large"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})])])],-1)),t("div",_t,[t("div",ft,m(x(b.value.diggCount)),1),e[25]||(e[25]=t("div",{class:"stat-label"},"点赞数",-1)),n.value.digg?(u(),g("div",gt,[l(o,{class:c({"trend-up":n.value.digg>0,"trend-down":n.value.digg<0})},{default:a(()=>[(u(),$(I(n.value.digg>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.digg))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card comments",{"is-active":d.value.comments}]),onClick:e[5]||(e[5]=r=>f("comments"))},[t("div",yt,[l(o,{size:"24"},{default:a(()=>[l(p(Oe))]),_:1})]),t("div",bt,[t("div",wt,m(x(b.value.commentCount)),1),e[27]||(e[27]=t("div",{class:"stat-label"},"评论数",-1)),n.value.comment?(u(),g("div",ht,[l(o,{class:c({"trend-up":n.value.comment>0,"trend-down":n.value.comment<0})},{default:a(()=>[(u(),$(I(n.value.comment>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.comment))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card collects",{"is-active":d.value.collects}]),onClick:e[6]||(e[6]=r=>f("collects"))},[t("div",Ct,[l(o,{size:"24"},{default:a(()=>[l(p(Te))]),_:1})]),t("div",kt,[t("div",St,m(x(b.value.collectCount)),1),e[28]||(e[28]=t("div",{class:"stat-label"},"收藏数",-1)),n.value.collect?(u(),g("div",Et,[l(o,{class:c({"trend-up":n.value.collect>0,"trend-down":n.value.collect<0})},{default:a(()=>[(u(),$(I(n.value.collect>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.collect))+"%",1)])):h("",!0)])],2),t("div",{class:c(["stat-card shares",{"is-active":d.value.shares}]),onClick:e[7]||(e[7]=r=>f("shares"))},[t("div",$t,[l(o,{size:"24"},{default:a(()=>[l(p(He))]),_:1})]),t("div",Dt,[t("div",xt,m(x(b.value.shareCount)),1),e[29]||(e[29]=t("div",{class:"stat-label"},"分享数",-1)),n.value.share?(u(),g("div",At,[l(o,{class:c({"trend-up":n.value.share>0,"trend-down":n.value.share<0})},{default:a(()=>[(u(),$(I(n.value.share>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),t("span",null,m(Math.abs(n.value.share))+"%",1)])):h("",!0)])],2)])):h("",!0),l(le,{class:"chart-card"},{header:a(()=>[t("div",Vt,[e[34]||(e[34]=t("span",{class:"card-title"},"数据趋势图",-1)),t("div",It,[t("div",{class:c(["legend-item",{"legend-disabled":!d.value.likes}]),onClick:e[8]||(e[8]=r=>f("likes"))},e[30]||(e[30]=[t("div",{class:"legend-dot likes-dot"},null,-1),t("span",null,"点赞",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.comments}]),onClick:e[9]||(e[9]=r=>f("comments"))},e[31]||(e[31]=[t("div",{class:"legend-dot comments-dot"},null,-1),t("span",null,"评论",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.collects}]),onClick:e[10]||(e[10]=r=>f("collects"))},e[32]||(e[32]=[t("div",{class:"legend-dot collects-dot"},null,-1),t("span",null,"收藏",-1)]),2),t("div",{class:c(["legend-item",{"legend-disabled":!d.value.shares}]),onClick:e[11]||(e[11]=r=>f("shares"))},e[33]||(e[33]=[t("div",{class:"legend-dot shares-dot"},null,-1),t("span",null,"分享",-1)]),2)])])]),default:a(()=>[t("div",zt,[D.value?(u(),$(p(ge),{key:0,option:D.value,style:{height:"450px"},autoresize:""},null,8,["option"])):k.value?h("",!0):(u(),g("div",Lt,[l(se,{description:"暂无图表数据"})]))])]),_:1})])),[[re,k.value]])])]),l(ie,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=r=>S.value=r),title:"更新邮箱",width:"420px"},{footer:a(()=>[l(V,{onClick:e[13]||(e[13]=r=>S.value=!1)},{default:a(()=>e[35]||(e[35]=[_("取消",-1)])),_:1,__:[35]}),l(V,{type:"primary",loading:M.value,onClick:K},{default:a(()=>e[36]||(e[36]=[_("确定",-1)])),_:1,__:[36]},8,["loading"])]),default:a(()=>[l(ne,{model:E.value,"label-width":"80px"},{default:a(()=>[l(oe,{label:"邮箱"},{default:a(()=>[l(ae,{modelValue:E.value.email,"onUpdate:modelValue":e[12]||(e[12]=r=>E.value.email=r),placeholder:"请输入新的邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},jt=de(Mt,[["__scopeId","data-v-9ce0941e"]]);export{jt as default};
