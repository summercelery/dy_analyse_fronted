/* empty css                  *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                        *//* empty css                  */import{a as Ne}from"./author-7ca79e9d.js";/* empty css               *//* empty css                 */import{X as pt,u as _t,a as gt,r as C,n as j,p as yt,Y as ht,o as m,c as y,d as s,e as l,w as o,t as u,s as g,h as f,N as Z,O as fe,Z as L,_ as oe,$ as N,x as v,y as le,z as wt,A as It,B as kt,C as Ct,k as Vt,i as xt,U as Et,a0 as bt,G as Mt,J as Dt,K as St,L as ze,a1 as Tt,a2 as At,a3 as Lt,a4 as Nt,a5 as zt,M as Pt,a6 as $t,v as Ut,f as Ft,a7 as Rt,a8 as Bt,a9 as Ot,aa as Gt,ab as Jt,ac as jt,ad as qt,ae as Kt,af as Qt,ag as Wt,P as Xt,Q as Yt,R as Zt,T as Ht,ah as es,ai as ts,aj as ss,ak as as,al as os,am as ls,j as ns,an as is,ao as rs,l as us,ap as ds,F as cs}from"./index-ea0ef51f.js";import{m as q}from"./monitor-e18f7c95.js";import{m as we}from"./music-cb72a1f9.js";import{v as ve}from"./video-68f2c7a4.js";import{p as pe}from"./tagUtils-dd34c03c.js";import{_ as ms}from"./_plugin-vue_export-helper-c27b6911.js";const fs={class:"monitor-layout"},vs={class:"header"},ps={class:"header-right"},_s={class:"user-info"},gs={class:"username"},ys={class:"main-container"},hs={class:"sidebar"},ws={class:"content"},Is={class:"page-header"},ks={key:0,class:"page-title-section"},Cs={class:"page-title"},Vs={class:"music-meta"},xs={class:"page-meta"},Es={key:0},bs={class:"stats-row"},Ms={class:"stat-icon"},Ds={class:"stat-info"},Ss={class:"stat-value"},Ts={class:"stat-icon"},As={class:"stat-info"},Ls={class:"stat-value"},Ns={class:"stat-icon"},zs={class:"stat-info"},Ps={class:"stat-value"},$s={class:"stat-icon"},Us={class:"stat-info"},Fs={class:"stat-value"},Rs={key:0,class:"tag-filter-section"},Bs={class:"tag-filter-header"},Os={class:"tag-filter-content"},Gs={class:"toolbar"},Js={class:"toolbar-left"},js={class:"toolbar-right"},qs={class:"card-header"},Ks={class:"header-actions"},Qs={class:"video-id"},Ws={key:1};const Xs={class:"video-desc"},Ys={class:"desc-text"},Zs={key:1,class:"na-text"},Hs={class:"author-name"},ea={key:0,class:"hashtag-list"},ta={key:1,class:"na-text"},sa={key:0,class:"search-tag"},aa={key:1,class:"na-text"},oa={key:0,class:"stats-preview"},la={class:"stats-item"},na={class:"stats-item"},ia={key:1,class:"na-text"},ra={class:"publish-time"},ua={class:"create-time"},da={class:"table-actions"},ca={style:{"line-height":"1.6"}},ma={style:{margin:"8px 0"}},fa={class:"music-info-display"},va={class:"music-title"},pa={key:0,class:"music-album"},_a={key:1,class:"music-tags"},ga={class:"music-info-display"},ya={class:"task-progress-container"},ha={class:"task-info"},wa={class:"progress-section"},Ia={key:0,class:"progress-stats"},ka={class:"task-stats-row"},Ca={class:"task-stats-row"},Va={style:{color:"#67c23a"}},xa={style:{color:"#909399"}},Ea={style:{color:"#f56c6c"}},ba={key:0,class:"processing-tip"},Ma={key:1,class:"completed-message"},Da={key:2,class:"failed-message"},Sa={__name:"Monitor",setup(Ta){const Ie=pt(),ne=_t(),Q=gt(),ie=C(!1),_e=C(!1),D=C([]),re=C(""),U=C([]),T=C(null),b=C(null),W=C(!1),X=C(!1),ue=C(!1),ge=C(!1),K=C("single"),x=C({videoUrl:"",file:null}),w=C({id:null,fileName:"",status:"PENDING",progress:0,totalCount:0,processedCount:0,successCount:0,skipCount:0,errorCount:0}),P=C(null),H=C(!1),ye=C(!1),ee=C({email:""}),ke=j(()=>{let t=D.value;switch(R.value){case"all":t=D.value;break;case"manual":t=D.value.filter(i=>{var n;return((n=i.monitorVideo)==null?void 0:n.type)===1});break;case"auto":t=D.value.filter(i=>{var n;return((n=i.monitorVideo)==null?void 0:n.type)===0}),F.value&&(t=t.filter(i=>{var n;return((n=i.monitorVideo)==null?void 0:n.tag)===F.value}));break;case"error":t=D.value.filter(i=>{var r;const n=(r=i.monitorVideo)==null?void 0:r.status;return n!==0&&n!==1});break;default:t=D.value}if(T.value&&(t=t.filter(i=>{var r,c;return(((r=i.userMonitor)==null?void 0:r.musicId)||((c=i.monitorVideo)==null?void 0:c.musicId))===T.value})),re.value){const i=re.value.toLowerCase();t=t.filter(n=>{var M,V,p,z,S;const r=((V=(M=n.monitorVideo)==null?void 0:M.awemeId)==null?void 0:V.toString())||"",c=((p=n.monitorVideo)==null?void 0:p.videoUrl)||"",d=((z=n.authorInfo)==null?void 0:z.nickname)||"",I=((S=n.videoInfo)==null?void 0:S.authorId)||"";return r.toLowerCase().includes(i)||c.toLowerCase().includes(i)||d.toLowerCase().includes(i)||I.toLowerCase().includes(i)})}return t.slice().sort((i,n)=>{var d,I;const r=((d=i==null?void 0:i.latestStats)==null?void 0:d.diggCount)||0;return(((I=n==null?void 0:n.latestStats)==null?void 0:I.diggCount)||0)-r})});j(()=>D.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.status)===1})),j(()=>D.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.status)===0}));const Pe=j(()=>D.value.filter(t=>{var i;const e=(i=t.monitorVideo)==null?void 0:i.status;return e!==0&&e!==1})),$e=j(()=>D.value),Ue=j(()=>D.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.type)===1})),Ce=j(()=>D.value.filter(t=>{var e;return((e=t.monitorVideo)==null?void 0:e.type)===0})),R=C("all"),F=C(""),de=t=>{R.value=t,t!=="auto"&&(F.value="");const e={all:"已显示所有监控视频",manual:"已过滤显示手动添加的视频",auto:"已过滤显示自动添加的视频",error:"已过滤显示异常监控的视频"};v.success(e[t]||"过滤完成")},Fe=t=>{F.value===t?F.value="":F.value=t},Re=()=>{F.value="",v.success("已清除标签筛选")},Be=j(()=>{const t=new Set;return Ce.value.forEach(e=>{var i;(i=e.monitorVideo)!=null&&i.tag&&t.add(e.monitorVideo.tag)}),Array.from(t).sort()}),te=t=>{var i;let e=null;if((i=t.videoInfo)!=null&&i.topics?e=t.videoInfo.topics:t.topics&&(e=t.topics),Array.isArray(e))return e;if(typeof e=="string")try{const n=JSON.parse(e);if(Array.isArray(n))return n}catch{}return[]},he=t=>{var n;let e=null;return(n=t.videoInfo)!=null&&n.desc?e=t.videoInfo.desc:t.desc&&(e=t.desc),e?e.replace(/#[^\s#]*/g,"").trim()||e:""},Ve=t=>t?t>=1e4?(t/1e4).toFixed(1)+"w":t.toString():"0",Oe=t=>t?new Date(t*1e3).toLocaleString("zh-CN"):"N/A",Ge=t=>t?new Date(t).toLocaleString("zh-CN"):"N/A",Je=t=>t?t>=1e4?(t/1e4).toFixed(1)+"w":t.toString():"0",je=t=>{switch(t){case 1:return"success";case 0:return"info";case 2:return"warning";case 3:return"danger";default:return"info"}},qe=t=>{switch(t){case 1:return"启用";case 0:return"停用";case 2:return"无权限";case 3:return"失败";default:return"未知"}},B=async()=>{ie.value=!0;try{const t=await q.getMonitorList();if(console.log("Monitor页面: 监控列表API响应:",t),t.code===200){let e=t.data||[];console.log("Monitor页面: 处理后的监控数据:",e),T.value&&(e=e.filter(i=>{var r,c;return(((r=i.userMonitor)==null?void 0:r.musicId)||((c=i.monitorVideo)==null?void 0:c.musicId))==T.value}),console.log("Monitor页面: 过滤后的音乐监控数据:",e)),e.length>0&&console.log("Monitor页面: 第一条数据结构:",JSON.stringify(e[0],null,2));try{const i=await ve.getMonitorVideoDetails();if(console.log("Monitor页面: 详细信息API响应:",i),i.code===200){const n=i.data||[];console.log("Monitor页面: 详细信息数据:",n);const r=await Promise.all(e.map(async c=>{var p,z,S,E,O,h;const d=n.find(k=>{var G,ce,J,ae;return((G=k.monitor)==null?void 0:G.awemeId)===((ce=c.monitorVideo)==null?void 0:ce.awemeId)||((J=k.monitorVideo)==null?void 0:J.awemeId)===((ae=c.monitorVideo)==null?void 0:ae.awemeId)});let I=(d==null?void 0:d.music)||(d==null?void 0:d.musicInfo),M=d==null?void 0:d.video,V=null;if(!I&&((p=c.userMonitor)!=null&&p.musicId||(z=c.monitorVideo)!=null&&z.musicId))try{const k=((S=c.userMonitor)==null?void 0:S.musicId)||((E=c.monitorVideo)==null?void 0:E.musicId),G=await we.getMusicById(k);G.code===200&&(I=G.data)}catch(k){console.warn("获取音乐信息失败:",k)}if(!M&&((O=c.monitorVideo)!=null&&O.awemeId))try{const k=await ve.getVideoInfo(c.monitorVideo.awemeId);k.code===200&&(M=k.data)}catch(k){console.warn("获取视频信息失败:",k)}if(M!=null&&M.authorId)try{const k=await Ne.getAuthorInfo(M.authorId);k.code===200&&(V=k.data)}catch(k){console.warn("获取播主信息失败:",k)}return{...c,musicInfo:I,videoInfo:M,authorInfo:V,latestStats:(d==null?void 0:d.latestStats)||((h=d==null?void 0:d.video)==null?void 0:h.latestStats),video:d==null?void 0:d.video}}));console.log("Monitor页面: 合并后的数据:",r),D.value=r}else{const n=await Promise.all(e.map(async r=>{var V,p,z,S,E,O;let c=null,d=null,I=null,M=null;if((V=r.userMonitor)!=null&&V.musicId||(p=r.monitorVideo)!=null&&p.musicId)try{const h=((z=r.userMonitor)==null?void 0:z.musicId)||((S=r.monitorVideo)==null?void 0:S.musicId),k=await we.getMusicById(h);k.code===200&&(c=k.data)}catch(h){console.warn("获取音乐信息失败:",h)}if((E=r.monitorVideo)!=null&&E.awemeId)try{const h=await ve.getVideoInfo(r.monitorVideo.awemeId);h.code===200&&(d=h.data)}catch(h){console.warn("获取视频信息失败:",h)}if(d!=null&&d.authorId)try{const h=await Ne.getAuthorInfo(d.authorId);h.code===200&&(I=h.data)}catch(h){console.warn("获取播主信息失败:",h)}if((O=r.monitorVideo)!=null&&O.awemeId)try{const h=await ve.getLatestVideoStats(r.monitorVideo.awemeId);h.code===200&&(M=h.data)}catch(h){console.warn("获取统计数据失败:",h)}return{...r,musicInfo:c,videoInfo:d,authorInfo:I,latestStats:M}}));D.value=n}}catch(i){console.warn("Monitor页面: 获取详细信息失败，使用基础数据:",i),D.value=e}}else v.error(t.message||"加载监控列表失败")}catch(t){console.error("Monitor页面: 加载监控列表失败:",t),v.error("加载监控列表失败")}finally{ie.value=!1}},Ke=async()=>{var t,e,i,n;if(!x.value.videoUrl.trim()){v.warning("请输入视频链接或ID");return}if(!T.value){v.warning("请先选择要监控的音乐");return}_e.value=!0;try{const r=await q.addMonitor({videoUrl:x.value.videoUrl.trim(),musicId:T.value});r.code===200?(v.success("添加监控成功"),W.value=!1,x.value={videoUrl:"",file:null},await B()):(t=r.message)!=null&&t.includes("音乐ID不能为空，音乐为必选项")?v.error("音乐为必选项，请先选择音乐"):(e=r.message)!=null&&e.includes("指定的音乐不存在，请选择有效的音乐")?v.error("所选音乐不存在，请重新选择"):(i=r.message)!=null&&i.includes("视频链接不能为空")?v.error("请输入视频链接"):(n=r.message)!=null&&n.includes("添加失败，可能是链接格式错误或已存在")?v.error("视频链接格式错误或该视频已在监控中"):v.error(r.message||"添加监控失败")}catch{v.error("添加监控失败")}finally{_e.value=!1}},xe=()=>{if(x.value={videoUrl:"",file:null},se.value)try{se.value.clearFiles()}catch(t){console.warn("清理上传组件失败:",t)}},Qe=()=>{const t=document.createElement("a");t.href="/监控视频模板.xlsx",t.download="监控视频模板.xlsx",document.body.appendChild(t),t.click(),document.body.removeChild(t)},se=C(),We=t=>{var n,r;if(console.log("文件选择:",t),!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/csv"].includes(t.raw.type)&&!t.name.endsWith(".csv")){v.error("请选择 .xlsx、.xls 或 .csv 格式的文件");try{(n=se.value)==null||n.clearFiles()}catch(c){console.warn("清理上传文件失败:",c)}x.value.file=null;return}const i=10*1024*1024;if(t.raw.size>i){v.error("文件大小不能超过 10MB");try{(r=se.value)==null||r.clearFiles()}catch(c){console.warn("清理上传文件失败:",c)}x.value.file=null;return}x.value.file=t.raw},Xe=()=>{console.log("文件移除"),x.value.file=null},Ye=async()=>{var t,e,i,n,r;if(!T.value){v.warning("请先选择要监控的音乐");return}if(!x.value.file){v.warning("请选择要上传的Excel文件");return}if(!x.value.file.name){v.error("文件信息不完整，请重新选择文件"),x.value.file=null;return}ge.value=!0;try{const c=new FormData;c.append("file",x.value.file),c.append("musicId",T.value.toString()),console.log("开始上传Excel文件:",{fileName:x.value.file.name,fileSize:x.value.file.size,musicId:T.value});const d=await q.uploadExcelAsync(c);if(d.code===200){const{taskId:I,message:M}=d.data;v.success("文件上传成功，正在后台处理中...");const V=((t=x.value.file)==null?void 0:t.name)||"未知文件";W.value=!1,xe(),Ze(I,V)}else{let I=d.message||"Excel上传失败";(e=d.message)!=null&&e.includes("请选择要上传的Excel文件")?I="请选择要上传的Excel文件":(i=d.message)!=null&&i.includes("文件格式不正确，请上传Excel文件(.xlsx或.xls)")?I="文件格式不正确，请上传Excel文件(.xlsx或.xls)":(n=d.message)!=null&&n.includes("音乐ID不能为空，音乐为必选项")?I="音乐为必选项，请先选择音乐":(r=d.message)!=null&&r.includes("指定的音乐不存在，请选择有效的音乐")&&(I="所选音乐不存在，请重新选择音乐"),v.error(I)}}catch(c){console.error("Excel上传失败:",c),v.error("Excel上传失败，请检查网络连接后重试")}finally{ge.value=!1}},Ze=(t,e)=>{w.value={id:t,fileName:e,status:"PENDING",progress:0,totalCount:0,processedCount:0,successCount:0,skipCount:0,errorCount:0},ue.value=!0,He()},He=()=>{P.value&&clearInterval(P.value),P.value=setInterval(async()=>{try{const t=await q.getTaskProgress(w.value.id);if(t.code===200){const e=t.data;w.value={...w.value,...e},(e.status==="COMPLETED"||e.status==="FAILED")&&(clearInterval(P.value),P.value=null,e.status==="COMPLETED"&&await B())}}catch(t){console.error("查询任务进度失败:",t)}},2e3)},Ee=()=>{P.value&&(clearInterval(P.value),P.value=null),ue.value=!1},et=t=>{switch(t){case"PENDING":return"等待处理";case"PROCESSING":return"处理中";case"COMPLETED":return"已完成";case"FAILED":return"处理失败";default:return"未知状态"}},tt=t=>{switch(t){case"PENDING":return"info";case"PROCESSING":return"warning";case"COMPLETED":return"success";case"FAILED":return"danger";default:return"info"}},st=t=>{t?ne.push(`/stats/${t}`):v.warning("视频ID无效")},at=async t=>{var r;const i=((r=t.monitorVideo)==null?void 0:r.status)===1?0:1,n=i===1?"启用":"停用";try{await le.confirm(`确认${n}该监控视频？`,"提示",{type:"warning"});const c=await q.updateStatus(t.monitorVideo.id,{status:i});c.code===200?(await B(),v.success(`${n}成功`)):v.error(c.message||`${n}失败`)}catch(c){c!=="cancel"&&v.error(`${n}失败`)}},ot=async t=>{try{await le.confirm("确认删除该监控视频？删除后无法恢复","警告",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"});const e=await q.deleteMonitor(t.monitorVideo.id);e.code===200?(await B(),v.success("删除成功")):v.error(e.message||"删除失败")}catch(e){e!=="cancel"&&v.error("删除失败")}},lt=t=>{U.value=t},be=async t=>{const e=t===1?"启用":"停用";try{await le.confirm(`确认批量${e}选中的 ${U.value.length} 个监控项？`,"提示",{type:"warning"});const i=U.value.map(n=>q.updateStatus(n.monitorVideo.id,{status:t}));await Promise.all(i),await B(),X.value=!1,U.value=[],v.success(`批量${e}成功`)}catch(i){i!=="cancel"&&v.error(`批量${e}失败`)}},nt=async()=>{try{await le.confirm(`确认批量删除选中的 ${U.value.length} 个监控项？删除后无法恢复`,"警告",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"});const t=U.value.map(e=>q.deleteMonitor(e.monitorVideo.id));await Promise.all(t),await B(),X.value=!1,U.value=[],v.success("批量删除成功")}catch(t){t!=="cancel"&&v.error("批量删除失败")}},it=async t=>{var e;if(t==="updateEmail"){ee.value.email=((e=Q.user)==null?void 0:e.email)||"",H.value=!0;return}if(t==="logout")try{await le.confirm("确认退出登录？","提示",{type:"warning"}),await Q.logout(),ne.push("/login")}catch{}},rt=t=>/^[\w.!#$%&'*+/=?^`{|}~-]+@[\w-]+(\.[\w-]+)+$/.test(t),ut=async()=>{const t=(ee.value.email||"").trim();if(!t){v.warning("请输入邮箱地址");return}if(!rt(t)){v.warning("邮箱格式不正确");return}ye.value=!0;try{const e=await Wt.updateEmail({email:t});e.code===200?(Q.setUser({...Q.user||{},email:t}),v.success("邮箱更新成功"),H.value=!1):v.error(e.message||"邮箱更新失败")}catch{v.error("邮箱更新失败，请稍后重试")}finally{ye.value=!1}},dt=()=>{ne.push("/music")},ct=t=>{var i,n;const e=((i=t==null?void 0:t.videoInfo)==null?void 0:i.authorId)||((n=t==null?void 0:t.authorInfo)==null?void 0:n.userId);e?ne.push(`/author/${e}`):v.warning("无法获取播主ID")};return yt(()=>{Ie.query.musicId&&(T.value=parseInt(Ie.query.musicId),we.getMusicById(T.value).then(t=>{(t==null?void 0:t.code)===200&&(b.value=t.data)}).catch(()=>{})),B()}),ht(()=>{P.value&&(clearInterval(P.value),P.value=null)}),(t,e)=>{var De;const i=wt,n=It,r=Xt,c=Yt,d=kt,I=Zt,M=Ct,V=Ht,p=Vt,z=xt,S=es,E=ts,O=ss,h=as,k=Et,G=os,ce=ls,J=ns,ae=is,mt=rs,Me=us,me=bt,ft=ds,vt=cs;return m(),y("div",fs,[s("header",vs,[e[22]||(e[22]=s("div",{class:"header-left"},[s("h1",{class:"system-title"},"抖音短视频分析系统")],-1)),s("div",ps,[s("div",_s,[l(i,{size:32,class:"user-avatar"},{default:o(()=>{var a,_;return[f(u((_=(a=g(Q).user)==null?void 0:a.username)==null?void 0:_.charAt(0)),1)]}),_:1}),s("span",gs,u((De=g(Q).user)==null?void 0:De.username),1),l(d,{onCommand:it,class:"user-dropdown"},{dropdown:o(()=>[l(c,null,{default:o(()=>[l(r,{command:"updateEmail"},{default:o(()=>e[20]||(e[20]=[f("更新邮箱",-1)])),_:1,__:[20]}),l(r,{command:"logout"},{default:o(()=>e[21]||(e[21]=[f("退出登录",-1)])),_:1,__:[21]})]),_:1})]),default:o(()=>[l(n,{class:"dropdown-icon"},{default:o(()=>[l(g(Mt))]),_:1})]),_:1})])])]),s("div",ys,[s("nav",hs,[l(M,{"default-active":t.$route.path,router:"",class:"sidebar-menu"},{default:o(()=>[l(I,{index:"/music",class:"menu-item"},{default:o(()=>[l(n,null,{default:o(()=>[l(g(Dt))]),_:1}),e[23]||(e[23]=s("span",null,"音乐管理",-1))]),_:1,__:[23]})]),_:1},8,["default-active"])]),s("main",ws,[s("div",Is,[T.value&&b.value?(m(),y("div",ks,[s("h2",Cs,[f(u(b.value.title)+" ",1),s("span",Vs," · "+u(b.value.author),1)]),s("p",xs,[s("span",null,"专辑："+u(b.value.album||"-"),1),b.value.tagList&&g(pe)(b.value.tagList).length?(m(),y("span",Es,[e[24]||(e[24]=f(" · 标签： ",-1)),(m(!0),y(Z,null,fe(g(pe)(b.value.tagList),a=>(m(),N(V,{key:a,size:"small",class:"music-tag"},{default:o(()=>[f(u(a),1)]),_:2},1024))),128))])):L("",!0)])])):(m(),y(Z,{key:1},[e[25]||(e[25]=s("h2",{class:"page-title"},"监控管理",-1)),e[26]||(e[26]=s("p",{class:"page-desc"},"管理您的抖音视频监控任务，实时掌握数据变化",-1))],64))]),s("div",bs,[s("div",{class:oe(["stat-card total",{"is-active":R.value==="all"}]),onClick:e[0]||(e[0]=a=>de("all"))},[s("div",Ms,[l(n,{size:"20"},{default:o(()=>[l(g(St))]),_:1})]),s("div",Ds,[s("div",Ss,u($e.value.length),1),e[27]||(e[27]=s("div",{class:"stat-label"},"监控视频总数",-1))])],2),s("div",{class:oe(["stat-card manual",{"is-active":R.value==="manual"}]),onClick:e[1]||(e[1]=a=>de("manual"))},[s("div",Ts,[l(n,{size:"20"},{default:o(()=>[l(g(ze))]),_:1})]),s("div",As,[s("div",Ls,u(Ue.value.length),1),e[28]||(e[28]=s("div",{class:"stat-label"},"手动添加",-1))])],2),s("div",{class:oe(["stat-card auto",{"is-active":R.value==="auto"}]),onClick:e[2]||(e[2]=a=>de("auto"))},[s("div",Ns,[l(n,{size:"20"},{default:o(()=>[l(g(Tt))]),_:1})]),s("div",zs,[s("div",Ps,u(Ce.value.length),1),e[29]||(e[29]=s("div",{class:"stat-label"},"自动添加",-1))])],2),s("div",{class:oe(["stat-card error",{"is-active":R.value==="error"}]),onClick:e[3]||(e[3]=a=>de("error"))},[s("div",$s,[l(n,{size:"20"},{default:o(()=>[l(g(At))]),_:1})]),s("div",Us,[s("div",Fs,u(Pe.value.length),1),e[30]||(e[30]=s("div",{class:"stat-label"},"异常监控",-1))])],2)]),R.value==="auto"?(m(),y("div",Rs,[s("div",Bs,[e[32]||(e[32]=s("span",{class:"tag-filter-title"},"搜索标签筛选：",-1)),l(p,{onClick:Re,size:"small",type:"info",icon:g(Lt),disabled:!F.value},{default:o(()=>e[31]||(e[31]=[f(" 清除标签筛选 ",-1)])),_:1,__:[31]},8,["icon","disabled"])]),s("div",Os,[(m(!0),y(Z,null,fe(Be.value,a=>(m(),N(V,{key:a,class:oe([{"tag-selected":F.value===a},"tag-filter-tag"]),onClick:_=>Fe(a),size:"large"},{default:o(()=>[f(u(a),1)]),_:2},1032,["class","onClick"]))),128))])])):L("",!0),e[38]||(e[38]=s("div",{class:"section-divider"},null,-1)),s("div",Gs,[s("div",Js,[T.value?(m(),N(p,{key:0,onClick:dt,icon:g(Nt)},{default:o(()=>e[33]||(e[33]=[f(" 返回 ",-1)])),_:1,__:[33]},8,["icon"])):L("",!0),l(p,{type:"primary",onClick:e[4]||(e[4]=a=>W.value=!0),icon:g(zt)},{default:o(()=>e[34]||(e[34]=[f(" 添加监控 ",-1)])),_:1,__:[34]},8,["icon"]),l(p,{onClick:B,loading:ie.value,icon:g(Pt)},{default:o(()=>e[35]||(e[35]=[f(" 刷新 ",-1)])),_:1,__:[35]},8,["loading","icon"])]),s("div",js,[l(z,{modelValue:re.value,"onUpdate:modelValue":e[5]||(e[5]=a=>re.value=a),placeholder:"搜索视频ID、链接或播主名称","prefix-icon":g($t),style:{width:"300px"},clearable:""},null,8,["modelValue","prefix-icon"])])]),l(k,{class:"monitor-table-card"},{header:o(()=>[s("div",qs,[e[36]||(e[36]=s("span",{class:"card-title"},"监控列表",-1)),s("div",Ks,[l(S,{content:"批量操作",placement:"top"},{default:o(()=>[l(p,{disabled:U.value.length===0,onClick:e[6]||(e[6]=a=>X.value=!0),size:"small"},{default:o(()=>[f(" 批量操作 ("+u(U.value.length)+") ",1)]),_:1},8,["disabled"])]),_:1})])])]),default:o(()=>[Ut((m(),y("div",null,[l(h,{data:ke.value,style:{width:"100%"},onSelectionChange:lt,"empty-text":ke.value.length===0?"暂无监控数据":"",size:"default","cell-style":{padding:"6px 6px"},"header-cell-style":{padding:"8px 6px",background:"#fafafa"}},{default:o(()=>[l(E,{type:"selection",width:"50"}),l(E,{label:"视频ID",width:"140"},{default:o(({row:a})=>{var _,A,$,Y,Se,Te;return[s("div",Qs,[(_=a.monitorVideo)!=null&&_.awemeId||(A=a.monitorVideo)!=null&&A.id||a.awemeId?(m(),N(O,{key:0,href:`https://www.douyin.com/video/${(($=a.monitorVideo)==null?void 0:$.awemeId)||((Y=a.monitorVideo)==null?void 0:Y.id)||a.awemeId}`,target:"_blank",type:"primary",class:"video-id-link"},{default:o(()=>{var Ae,Le;return[f(u(((Ae=a.monitorVideo)==null?void 0:Ae.awemeId)||((Le=a.monitorVideo)==null?void 0:Le.id)||a.awemeId||"N/A"),1)]}),_:2},1032,["href"])):(m(),y("span",Ws,u(((Se=a.monitorVideo)==null?void 0:Se.awemeId)||((Te=a.monitorVideo)==null?void 0:Te.id)||a.awemeId||"N/A"),1))]),L("",!0)]}),_:1}),l(E,{label:"视频描述",width:"200"},{default:o(({row:a})=>[s("div",Xs,[he(a)?(m(),N(S,{key:0,content:he(a),placement:"top","show-after":500},{default:o(()=>[s("span",Ys,u(he(a)),1)]),_:2},1032,["content"])):(m(),y("span",Zs,"无描述"))])]),_:1}),l(E,{label:"播主名称",width:"140"},{default:o(({row:a})=>{var _;return[s("div",Hs,[l(O,{type:"primary",class:"author-nickname",onClick:Ft(A=>ct(a),["stop"])},{default:o(()=>{var A,$;return[f(u(((A=a.authorInfo)==null?void 0:A.nickname)||(($=a.videoInfo)==null?void 0:$.authorId)||"N/A"),1)]}),_:2},1032,["onClick"]),(_=a.authorInfo)!=null&&_.followerCount?(m(),N(V,{key:0,size:"small",type:"info",class:"author-followers-tag"},{default:o(()=>[f(" 粉丝 "+u(Je(a.authorInfo.followerCount)),1)]),_:2},1024)):L("",!0)])]}),_:1}),l(E,{label:"话题标签",width:"200"},{default:o(({row:a})=>[te(a).length>0?(m(),y("div",ea,[(m(!0),y(Z,null,fe(te(a).slice(0,5),_=>(m(),N(V,{key:_,size:"small",type:"info",class:"hashtag-tag"},{default:o(()=>[f(u(_),1)]),_:2},1024))),128)),te(a).length>5?(m(),N(S,{key:0,content:te(a).slice(5).join("、"),placement:"top"},{default:o(()=>[l(V,{size:"small",type:"info",class:"hashtag-more"},{default:o(()=>[f(" +"+u(te(a).length-5),1)]),_:2},1024)]),_:2},1032,["content"])):L("",!0)])):(m(),y("span",ta,"无话题标签"))]),_:1}),R.value==="auto"?(m(),N(E,{key:0,label:"搜索标签",width:"150",align:"center"},{default:o(({row:a})=>{var _;return[(_=a.monitorVideo)!=null&&_.tag?(m(),y("div",sa,[l(V,{size:"small",type:"success",class:"search-tag-display"},{default:o(()=>[f(u(a.monitorVideo.tag),1)]),_:2},1024)])):(m(),y("span",aa,"无搜索标签"))]}),_:1})):L("",!0),l(E,{label:"最新数据",width:"140"},{default:o(({row:a})=>[a.latestStats?(m(),y("div",oa,[s("div",la,[e[37]||(e[37]=s("div",{class:"heart-icon"},[s("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})])],-1)),s("span",null,u(Ve(a.latestStats.diggCount||0)),1)]),s("div",na,[l(n,{size:"14"},{default:o(()=>[l(g(Rt))]),_:1}),s("span",null,u(Ve(a.latestStats.commentCount||0)),1)])])):(m(),y("span",ia,"暂无数据"))]),_:1}),l(E,{label:"发布时间",width:"160",align:"center"},{default:o(({row:a})=>{var _;return[s("div",ra,u(Oe((_=a.monitorVideo)==null?void 0:_.videoPublishTime)),1)]}),_:1}),l(E,{label:"创建时间",width:"160",align:"center"},{default:o(({row:a})=>{var _;return[s("div",ua,u(Ge((_=a.monitorVideo)==null?void 0:_.createTime)),1)]}),_:1}),l(E,{label:"状态",width:"100",align:"center"},{default:o(({row:a})=>{var _;return[l(V,{type:je((_=a.monitorVideo)==null?void 0:_.status),size:"small",class:"status-tag"},{default:o(()=>{var A;return[f(u(qe((A=a.monitorVideo)==null?void 0:A.status)),1)]}),_:2},1032,["type"])]}),_:1}),l(E,{label:"操作",width:"160",fixed:"right"},{default:o(({row:a})=>{var _;return[s("div",da,[l(S,{content:"查看统计",placement:"top"},{default:o(()=>[l(p,{type:"primary",size:"small",icon:g(Bt),onClick:A=>{var $;return st(($=a.monitorVideo)==null?void 0:$.awemeId)},link:""},null,8,["icon","onClick"])]),_:2},1024),l(S,{content:((_=a.monitorVideo)==null?void 0:_.status)===1?"停用监控":"启用监控",placement:"top"},{default:o(()=>{var A,$;return[l(p,{type:((A=a.monitorVideo)==null?void 0:A.status)===1?"warning":"success",size:"small",icon:(($=a.monitorVideo)==null?void 0:$.status)===1?g(Ot):g(Gt),onClick:Y=>at(a),link:""},{default:o(()=>{var Y;return[f(u(((Y=a.monitorVideo)==null?void 0:Y.status)===1?"停用":"启用"),1)]}),_:2},1032,["type","icon","onClick"])]}),_:2},1032,["content"]),l(S,{content:"删除监控",placement:"top"},{default:o(()=>[l(p,{type:"danger",size:"small",icon:g(Jt),onClick:A=>ot(a),link:""},null,8,["icon","onClick"])]),_:2},1024)])]}),_:1})]),_:1},8,["data","empty-text"])])),[[vt,ie.value]])]),_:1})])]),l(me,{modelValue:W.value,"onUpdate:modelValue":e[11]||(e[11]=a=>W.value=a),title:"添加监控视频",width:"600px"},{footer:o(()=>[l(p,{onClick:e[9]||(e[9]=a=>W.value=!1)},{default:o(()=>e[48]||(e[48]=[f("取消",-1)])),_:1,__:[48]}),l(p,{type:"primary",onClick:e[10]||(e[10]=a=>K.value==="single"?Ke():Ye()),loading:K.value==="single"?_e.value:ge.value,disabled:K.value==="batch"&&!x.value.file},{default:o(()=>[f(u(K.value==="single"?"添加监控":"开始导入"),1)]),_:1},8,["loading","disabled"])]),default:o(()=>[l(ce,{modelValue:K.value,"onUpdate:modelValue":e[7]||(e[7]=a=>K.value=a),style:{"margin-bottom":"20px"},onChange:xe},{default:o(()=>[l(G,{label:"single"},{default:o(()=>e[39]||(e[39]=[f("单个添加",-1)])),_:1,__:[39]}),l(G,{label:"batch"},{default:o(()=>e[40]||(e[40]=[f("批量导入",-1)])),_:1,__:[40]})]),_:1},8,["modelValue"]),l(Me,{model:x.value,"label-width":"100px"},{default:o(()=>[K.value==="single"?(m(),N(J,{key:0,label:"视频链接"},{default:o(()=>[l(z,{modelValue:x.value.videoUrl,"onUpdate:modelValue":e[8]||(e[8]=a=>x.value.videoUrl=a),placeholder:"请输入抖音视频链接或ID"},null,8,["modelValue"])]),_:1})):(m(),y(Z,{key:1},[l(ae,{title:"批量导入说明",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:o(()=>[s("div",ca,[e[42]||(e[42]=s("p",null,[s("strong",null,"Excel文件格式要求：")],-1)),e[43]||(e[43]=s("ul",{style:{margin:"8px 0","padding-left":"20px"}},[s("li",null,"支持 .xlsx、.xls 和 .csv 格式"),s("li",null,"第一行为标题行（监控视频地址），会被跳过"),s("li",null,"从第二行开始，第一列为视频链接")],-1)),s("p",ma,[l(p,{type:"primary",size:"small",onClick:Qe,icon:g(jt)},{default:o(()=>e[41]||(e[41]=[f(" 下载Excel模板 ",-1)])),_:1,__:[41]},8,["icon"])])])]),_:1}),l(J,{label:"Excel文件",required:""},{default:o(()=>[l(mt,{ref_key:"uploadRef",ref:se,"auto-upload":!1,"show-file-list":!0,limit:1,accept:".xlsx,.xls,.csv","on-change":We,"on-remove":Xe},{tip:o(()=>e[45]||(e[45]=[s("div",{class:"el-upload__tip",style:{color:"#909399","font-size":"12px","margin-top":"5px"}}," 支持 .xlsx/.xls/.csv 文件，且不超过 10MB ",-1)])),default:o(()=>[l(p,{icon:g(qt)},{default:o(()=>e[44]||(e[44]=[f("选择Excel文件",-1)])),_:1,__:[44]},8,["icon"])]),_:1},512)]),_:1})],64)),T.value&&b.value?(m(),N(J,{key:2,label:"音乐信息"},{default:o(()=>[s("div",fa,[s("div",va,u(b.value.title)+" - "+u(b.value.author),1),b.value.album?(m(),y("div",pa,"专辑："+u(b.value.album),1)):L("",!0),b.value.tagList&&g(pe)(b.value.tagList).length?(m(),y("div",_a,[e[46]||(e[46]=f(" 标签： ",-1)),(m(!0),y(Z,null,fe(g(pe)(b.value.tagList),a=>(m(),N(V,{key:a,size:"small",class:"music-tag"},{default:o(()=>[f(u(a),1)]),_:2},1024))),128))])):L("",!0)])]),_:1})):(m(),N(J,{key:3,label:"音乐信息"},{default:o(()=>[s("div",ga,[l(ae,{title:"请先选择音乐",type:"warning",closable:!1,"show-icon":""},{default:o(()=>e[47]||(e[47]=[s("p",null,"添加监控视频前，请先在音乐管理页面选择要监控的音乐",-1)])),_:1})])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(me,{modelValue:X.value,"onUpdate:modelValue":e[15]||(e[15]=a=>X.value=a),title:"批量操作",width:"400px"},{footer:o(()=>[l(p,{onClick:e[12]||(e[12]=a=>X.value=!1)},{default:o(()=>e[49]||(e[49]=[f("取消",-1)])),_:1,__:[49]}),l(p,{type:"success",onClick:e[13]||(e[13]=a=>be(1))},{default:o(()=>e[50]||(e[50]=[f(" 批量启用 ",-1)])),_:1,__:[50]}),l(p,{type:"warning",onClick:e[14]||(e[14]=a=>be(0))},{default:o(()=>e[51]||(e[51]=[f(" 批量停用 ",-1)])),_:1,__:[51]}),l(p,{type:"danger",onClick:nt},{default:o(()=>e[52]||(e[52]=[f(" 批量删除 ",-1)])),_:1,__:[52]})]),default:o(()=>[s("p",null,"已选择 "+u(U.value.length)+" 个监控项",1)]),_:1},8,["modelValue"]),l(me,{modelValue:ue.value,"onUpdate:modelValue":e[16]||(e[16]=a=>ue.value=a),title:"导入进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:Ee},{footer:o(()=>[l(p,{onClick:Ee,disabled:w.value.status==="PROCESSING"},{default:o(()=>[f(u(w.value.status==="PROCESSING"?"处理中...":"关闭"),1)]),_:1},8,["disabled"])]),default:o(()=>[s("div",ya,[s("div",ha,[s("p",null,[e[53]||(e[53]=s("strong",null,"文件名：",-1)),f(u(w.value.fileName),1)]),s("p",null,[e[54]||(e[54]=s("strong",null,"任务ID：",-1)),f(u(w.value.id),1)]),s("p",null,[e[55]||(e[55]=s("strong",null,"状态：",-1)),l(V,{type:tt(w.value.status),size:"small"},{default:o(()=>[f(u(et(w.value.status)),1)]),_:1},8,["type"])])]),s("div",wa,[l(ft,{percentage:w.value.progress,status:w.value.status==="COMPLETED"?"success":w.value.status==="FAILED"?"exception":null},null,8,["percentage","status"]),w.value.totalCount>0?(m(),y("div",Ia,[s("div",ka,[s("span",null,"总计："+u(w.value.totalCount),1),s("span",null,"已处理："+u(w.value.processedCount),1)]),s("div",Ca,[s("span",Va,"成功："+u(w.value.successCount),1),s("span",xa,"跳过："+u(w.value.skipCount),1),s("span",Ea,"失败："+u(w.value.errorCount),1)])])):L("",!0)]),w.value.status==="PROCESSING"?(m(),y("div",ba,[l(n,{class:"rotating"},{default:o(()=>[l(g(Kt))]),_:1}),e[56]||(e[56]=s("span",null,"正在处理中，请稍候...",-1))])):L("",!0),w.value.status==="COMPLETED"?(m(),y("div",Ma,[l(n,{style:{color:"#67c23a"}},{default:o(()=>[l(g(ze))]),_:1}),e[57]||(e[57]=s("span",null,"导入完成！",-1))])):L("",!0),w.value.status==="FAILED"?(m(),y("div",Da,[l(n,{style:{color:"#f56c6c"}},{default:o(()=>[l(g(Qt))]),_:1}),e[58]||(e[58]=s("span",null,"导入失败，请重试",-1))])):L("",!0)])]),_:1},8,["modelValue"]),l(me,{modelValue:H.value,"onUpdate:modelValue":e[19]||(e[19]=a=>H.value=a),title:"更新邮箱",width:"420px"},{footer:o(()=>[l(p,{onClick:e[18]||(e[18]=a=>H.value=!1)},{default:o(()=>e[59]||(e[59]=[f("取消",-1)])),_:1,__:[59]}),l(p,{type:"primary",loading:ye.value,onClick:ut},{default:o(()=>e[60]||(e[60]=[f("确定",-1)])),_:1,__:[60]},8,["loading"])]),default:o(()=>[l(Me,{model:ee.value,"label-width":"80px"},{default:o(()=>[l(J,{label:"邮箱"},{default:o(()=>[l(z,{modelValue:ee.value.email,"onUpdate:modelValue":e[17]||(e[17]=a=>ee.value.email=a),placeholder:"请输入新的邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Qa=ms(Sa,[["__scopeId","data-v-7531b6bd"]]);export{Qa as default};
